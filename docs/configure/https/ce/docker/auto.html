<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>Passbolt Help | Auto configure HTTPS with Let&#39;s Encrypt on Docker</title>
    <!--
             ____                  __          ____
            / __ \____  _____ ____/ /_  ____  / / /_
           / /_/ / __ `/ ___/ ___/ __ \/ __ \/ / __/
          / ____/ /_/ (__  |__  ) /_/ / /_/ / / /_
         /_/    \__,_/____/____/_.___/\____/_/\__/

         Open source password manager for teams
         ¬© 2019 Passbolt SA

     -->
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="">
    <meta property="og:image" content="https://help.passbolt.com/assets/img/background/og_preview.jpg" />
    <meta property="og:title" content="Auto configure HTTPS with Let&#39;s Encrypt on Docker" />
    <meta property="og:description" content="" />
    <link rel="stylesheet" href="https://help.passbolt.com/assets/css/help.min.css">
    <link rel="stylesheet" href="https://help.passbolt.com/assets/css/highlight.css">
    <link rel="stylesheet" href="https://help.passbolt.com/assets/css/cookie-eu-banner.css">
    <link rel="stylesheet" href="https://help.passbolt.com/assets/css/custom.css">
    <link rel="canonical" href="https://help.passbolt.com/configure/https/ce/docker/auto">
    <link rel="shortcut icon" type="image/x-icon" href="https://help.passbolt.com/assets/favicon.ico" />
    <link rel="alternate" type="application/rss+xml" title="Passbolt | Help" href="https://help.passbolt.com/feed.xml">
</head>


<body>
    <div id="container" class="help page background">
            <header>
        <div class="header first ">
            <nav class="greedy">
                <div class="top navigation primary">
                    <ul class="links clearfix">
                        <li class="home with-text"><a href="http://www.passbolt.com/"><span>home</span></a></li>
                        <li class="left"><a href="https://www.passbolt.com/services"><span>pricing</span></a></li>
                        <li class="left"><a href="https://www.passbolt.com/roadmap"><span>roadmap</span></a></li>
                        <li class="left"><a href="https://community.passbolt.com/"><span>forum</span></a></li>
                        <li class="left"><a href="https://www.passbolt.com/blog"><span>blog</span></a></li>
                        <li class="left selected"><a href="https://help.passbolt.com/"><span>help</span></a></li>
                        <li class="left"><a href="https://demo.passbolt.com" class="highlighted" target="_blank" rel="noopener"><span>try it!</span></a></li>
                    </ul>
                    <button class="hidden" count="0">more</button>
                    <ul class="hidden-links hidden"></ul>
                </div>
            </nav>
        </div>
    </header>
    <div class="header second">
        <div class="col1">
            <div class="logo no-img">
                <h1><span>Passbolt</span></h1>
            </div>
        </div>
        <div class="col2 search-wrapper">
            <h2 class="visuallyhidden">Help Search</h2>
            <div>
                <form class="search ready" action="/search.html" method="get">
                    <div class="input required">
                        <label for="search-box">Search</label>
                        <input id="search-box" name="query" maxlength="64" placeholder="Help search" class="fuzzy-search" type="search">
                    </div>
                    <button value="search">
                        <i class="fa fa-fw fa-search"></i>
                        <span class="text visuallyhidden">search</span>
                    </button>
                </form>
            </div>
        </div>
        <div class="col3">
            <div class="edit-on-github">
                <a href="https://github.com/passbolt/passbolt_help/edit/master/_posts/configure/2021-12-30-configure-https-docker-auto.md" class="button">
                    <i class="fa fa-github-alt fa-fw"></i> Edit on github</a>
            </div>
        </div>
    </div>

        <div class="panel main" aria-label="Content">
            <div class="panel left">
                
                









<div class="navigation-help" role="navigation">
    <ul>
        <li>
            <h2>Configure</h2>
        </li>
        
        <li >
            <a href="https://help.passbolt.com/configure/https">Configure HTTPS</a>
        </li>
        
        
        
        
        <li >
            <a href="https://help.passbolt.com/configure/ldap/setup">Configure LDAP</a>
        </li>
        
        
        <li >
            <a href="https://help.passbolt.com/configure/account-recovery">Configure Account Recovery</a>
        </li>
        
        
        <li >
            <a href="https://help.passbolt.com/configure/sso">Configure SSO</a>
        </li>
        
        
        <li >
            <a href="https://help.passbolt.com/configure/ldap/ldap-with-ssl">Configure LDAP with ssl</a>
        </li>
        
        
        <li >
            <a href="https://help.passbolt.com/configure/ldap/ldap-common-sync-error-messages">Troubleshoot LDAP sync errors</a>
        </li>
        
        
        <li >
            <a href="https://help.passbolt.com/configure/mfa/yubikey">Configure Yubikey</a>
        </li>
        
        
        <li >
            <a href="https://help.passbolt.com/configure/mfa/duo">Configure Duo</a>
        </li>
        
        
        <li >
            <a href="https://help.passbolt.com/configure/mfa/totp">Configure TOTP</a>
        </li>
        
        
        <li >
            <a href="https://help.passbolt.com/configure/notification/email">Configure Email Notifications</a>
        </li>
        
        
        <li >
            <a href="https://help.passbolt.com/configure/email/setup">Configure Email providers</a>
        </li>
        
        
        <li >
            <a href="https://help.passbolt.com/faq/hosting/why-email-not-sent">Troobleshoot Email config</a>
        </li>
        
        
        <li >
            <a href="https://help.passbolt.com/configure/environment/reference">Environment variable reference</a>
        </li>
        
        
        <li >
            <a href="https://help.passbolt.com/configure/database/credentials">Update database credentials</a>
        </li>
        
        
    </ul>
</div>








                
            </div>
            <div class="panel middle" data-spy="scroll" data-target=".scrollspy">
                <div class="grid grid-responsive-12">
                    <article>
                        <div class="row" id="introduction">
    <div class="col12">
        <div class="breadcrumbs">
            <ul>
                <li>
                    <div class="main-cell">
                        <a href="https://www.passbolt.com"><span>home</span></a>
                    </div>
                </li>
                <li>
                    <div class="main-cell">
                        <a href="/"><span>help</span></a>
                    </div>
                </li>
                
                
                <li>
                    <div class="main-cell">
                        <a href="https://help.passbolt.com/configure"><span>configure</span></a>
                    </div>
                </li>
                
                <li>
                    <div class="main-cell">
                        <a href="https://help.passbolt.com/configure/https"><span>https</span></a>
                    </div>
                </li>
                
                
                
                
                <li>
                    <div class="main-cell">
                        <a href="https://help.passbolt.com/configure/https/ce/docker/auto.html"><span>auto</span></a>
                    </div>
                </li>
                
            </ul>
        </div>
    </div>
</div>

                        <div class="row" markdown="1">
<div class="col7" markdown="1">
<h1>Auto configure HTTPS with Let's Encrypt on Docker</h1>
</div>
</div>

                        
<div class="row">
  <div class="col7">

    <div class="message warning">
    <p>
        If you are migrating your passbolt instance from HTTP to HTTPS, you must ensure <b>all of your users have a backup of their private key</b>.<br />
    As for passbolt browser extension, domain will change from HTTP to HTTPS, it will trigger <b><a href="/faq/start/account-recover">an account recovery</a></b>.
    </p>
    
</div>

    <div class="message warning">
    <p>
        <strong>Important requirement:</strong> This tutorial assumes your machine has a valid domain name assigned in
    order to work with let‚Äôs encrypt.
    </p>
    
</div>

    <h2 id="requirements">Requirements</h2>

    <ul>
      <li><a href="/hosting/install/ce/docker.html">docker setup with docker-compose</a></li>
      <li>A domain name reachable over the internet</li>
    </ul>

    <h3 id="add-traefik-service-to-handle-https">Add traefik service to handle https</h3>

    <p>If you have followed <a href="/hosting/install/ce/docker.html">our installation documentation</a>, you should have defined <strong>db</strong> and <strong>passbolt</strong> services for your passbolt stack.</p>

    <p>To handle HTTPS setup with Let‚Äôs Encrypt, add a traefik service as follow:</p>

    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>version: '3.7'
services:
  db:
    ...
  passbolt:
    ...
  traefik:
    image: traefik:2.6
    restart: always
    ports:
      - 80:80
      - 443:443
    volumes:
      - /var/run/docker.sock:/var/run/docker.sock:ro
      - ./traefik.yaml:/traefik.yaml:ro
      - ./conf/:/etc/traefik/conf
      - ./shared/:/shared
</code></pre></div>    </div>

    <p>Traefik will:</p>
    <ul>
      <li>act as a proxy in front of passbolt service, that‚Äôs why we defined ports 80 and 443.</li>
      <li>handle Let‚Äôs Encrypt certificates renew.</li>
    </ul>

    <h3 id="configuration-files">configuration files</h3>

    <p>Create a <strong>traefik.yaml</strong> configuration file with this content (replace yourname@domain.tld with your email for Let‚Äôs Encrypt):</p>

    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>global:
  sendAnonymousUsage: false
log:
  level: INFO
  format: common
providers:
  docker:
    endpoint: 'unix:///var/run/docker.sock'
    watch: true
    exposedByDefault: true
    swarmMode: false
  file:
    directory: /etc/traefik/conf/
    watch: true
api:
  dashboard: false
  debug: false
  insecure: false
entryPoints:
  web:
    address: ':80'
    http:
      redirections:
        entryPoint:
          to: websecure
          scheme: https
          permanent: true
  websecure:
    address: ':443'
certificatesResolvers:
  letsencrypt:
    acme:
      email: yourname@domain.tld
      storage: /shared/acme.json
      caServer: 'https://acme-v02.api.letsencrypt.org/directory'
      keyType: EC256
      httpChallenge:
        entryPoint: web
      tlsChallenge: {}
</code></pre></div>    </div>

    <p>Create a <strong>conf</strong> folder:</p>

    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>mkdir conf
</code></pre></div>    </div>

    <p>In the <strong>conf</strong> folder, create 2 files:</p>

    <p><strong>conf/headers.yaml</strong>:</p>

    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>http:
  middlewares:
    SslHeader:
      headers:
        FrameDeny: true
        AccessControlAllowMethods: 'GET,OPTIONS,PUT'
        AccessControlAllowOriginList:
          - origin-list-or-null
        AccessControlMaxAge: 100
        AddVaryHeader: true
        BrowserXssFilter: true
        ContentTypeNosniff: true
        ForceSTSHeader: true
        STSIncludeSubdomains: true
        STSPreload: true
        ContentSecurityPolicy: default-src 'self' 'unsafe-inline'
        CustomFrameOptionsValue: SAMEORIGIN
        ReferrerPolicy: same-origin
        PermissionsPolicy: vibrate 'self'
        STSSeconds: 315360000
</code></pre></div>    </div>

    <p><strong>conf/tls.yaml</strong>:</p>

    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>tls:
  options:
    default:
      minVersion: VersionTLS12
      sniStrict: true
      curvePreferences:
        - CurveP521
        - CurveP384
      cipherSuites:
        - TLS_ECDHE_ECDSA_WITH_AES_128_GCM_SHA256
        - TLS_ECDHE_ECDSA_WITH_AES_256_GCM_SHA384
        - TLS_ECDHE_ECDSA_WITH_CHACHA20_POLY1305_SHA256
</code></pre></div>    </div>

    <p><strong>traefik.yaml</strong>, <strong>conf/headers.yaml</strong> and <strong>conf/tls.yaml</strong> will be mounted inside traefik container.</p>

    <h3 id="handle-passbolt-with-traefik">Handle passbolt with Traefik</h3>

    <p>To make Traefik redirect incoming requests to passbolt, edit the <strong>passbolt</strong> service as follow:</p>

    <p><strong>Step 1.</strong> As traefik will handle HTTPS connexion, remove the ports definition for passbolt service</p>

    <p><strong>Step 2.</strong> Add docker labels to make Traefik aware of passbolt service</p>

    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>version: '3.7'
services:
  db:
    ...
  passbolt:
    ...
    labels:
      traefik.enable: "true"
      traefik.http.routers.passbolt-http.entrypoints: "web"
      traefik.http.routers.passbolt-http.rule: "Host(`passbolt.domain.tld`)"
      traefik.http.routers.passbolt-http.middlewares: "SslHeader@file"
      traefik.http.routers.passbolt-https.middlewares: "SslHeader@file"
      traefik.http.routers.passbolt-https.entrypoints: "websecure"
      traefik.http.routers.passbolt-https.rule: "Host(`passbolt.domain.tld`)"
      traefik.http.routers.passbolt-https.tls: "true"
      traefik.http.routers.passbolt-https.tls.certresolver: "letsencrypt"
  traefik:
    ...
</code></pre></div>    </div>

    <div class="message warning">
    <p>
        Ensure you have correctly set your domain name (replace passbolt.domain.tld with your own in the example above).
    </p>
    
</div>

    <h2 id="non-root-images">non-root images</h2>

    <p>If you are using non-root images, add <code class="language-plaintext highlighter-rouge">loadbalancer.server.port</code> label to make traefik aware of the to be used port for passbolt service:</p>

    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>version: '3.7'
services:
  db:
    ...
  passbolt:
    ...
    labels:
      ...
      traefik.http.services.passbolt-https.loadbalancer.server.port: 8080
</code></pre></div>    </div>

    <h2 id="thats-it">That‚Äôs it</h2>

    <p>Launch <code class="language-plaintext highlighter-rouge">docker-compose up -d</code> and you should be able to reach passbolt with HTTPS and a Let‚Äôs Encrypt certificate.
The renewal of the certificate will be handled automatically by Traefik daemon.</p>

    <div class="last-updated">
      <h3>Last updated</h3>
      <p>This article was last updated on 
December
30th,
2021.</p>
    </div>

  </div>
  <div class="col4 last push1">

    <div class="message tldr notice">
    <p>Are you experiencing issues when installing passbolt?</p>
    
    <a href="https://community.passbolt.com/c/installation-issues" class="button primary">Ask the community!</a>
    
</div>

  </div>
</div>

                    </article>
                </div>
            </div>
        </div>
            <footer>
        <div class="footer">
            <ul class="footer-links">
                <li><a href="https://www.passbolt.com/licence">Terms</a></li>
                <li><a href="https://www.passbolt.com/privacy">Privacy</a></li>
                <li><a href="https://www.passbolt.com/credits">Credits</a></li>
                <li><a href="https://careers.passbolt.com">Careers</a></li>
            </ul>
        </div>
    </footer>
    <div id="cookies-eu-banner" class="visually-hidden">
        üç™ &nbsp; Do you accept cookies for statistical purposes?
        <a href="https://www.passbolt.com/privacy" id="cookies-eu-more">(Read more)</a>
        <a class="button primary" id="cookies-eu-accept">Accept</a>
        <a id="cookies-eu-reject">No thanks!</a>
    </div>


    </div>
    <script src="https://consent.cookiebot.com/uc.js" data-cbid="900808a8-f178-4994-b2ad-66bf3ccca5f7" data-blockingmode="auto" strategy="beforeInteractive"></script>
<script src="https://help.passbolt.com/assets/js/matomo-tag-manager.js"></script>
<script src="https://help.passbolt.com/assets/js/matomo-analytics.js"></script>
<script src="https://code.jquery.com/jquery-3.5.0.slim.min.js" integrity="sha384-/IFzzQmt1S744I+IQO4Mc1uphkxbXt1tEwjQ/qSw2p8pXWck09sLvqHmKDYYwReJ" crossorigin="anonymous"></script>
<script src="https://help.passbolt.com/assets/js/analytics.js"></script>
<script src="https://help.passbolt.com/assets/js/greedynav.js"></script>
</body>

</html>