<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>Passbolt Help | Update passbolt server component (v2)</title>
    <!--
             ____                  __          ____
            / __ \____  _____ ____/ /_  ____  / / /_
           / /_/ / __ `/ ___/ ___/ __ \/ __ \/ / __/
          / ____/ /_/ (__  |__  ) /_/ / /_/ / / /_
         /_/    \__,_/____/____/_.___/\____/_/\__/

         Open source password manager for teams
         ¬© 2019 Passbolt SA

     -->
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="">
    <meta property="og:image" content="https://help.passbolt.com/assets/img/background/og_preview.jpg" />
    <meta property="og:title" content="Update passbolt server component (v2)" />
    <meta property="og:description" content="" />
    <link rel="stylesheet" href="https://help.passbolt.com/assets/css/help.min.css">
    <link rel="stylesheet" href="https://help.passbolt.com/assets/css/highlight.css">
    <link rel="stylesheet" href="https://help.passbolt.com/assets/css/cookie-eu-banner.css">
    <link rel="canonical" href="https://help.passbolt.com/hosting/update/install-scripts">
    <link rel="shortcut icon" type="image/x-icon" href="https://help.passbolt.com/assets/favicon.ico" />
    <link rel="alternate" type="application/rss+xml" title="Passbolt | Help" href="https://help.passbolt.com/feed.xml">

</head>


<body>
    <div id="container" class="help page background">
            <header>
        <div class="header first ">
            <nav class="greedy">
                <div class="top navigation primary">
                    <ul class="links clearfix">
                        <li class="home with-text"><a href="http://www.passbolt.com/"><span>home</span></a></li>
                        <li class="left"><a href="https://www.passbolt.com/services"><span>pricing</span></a></li>
                        <li class="left"><a href="https://www.passbolt.com/roadmap"><span>roadmap</span></a></li>
                        <li class="left"><a href="https://community.passbolt.com/"><span>forum</span></a></li>
                        <li class="left"><a href="https://www.passbolt.com/blog"><span>blog</span></a></li>
                        <li class="left selected"><a href="https://help.passbolt.com/"><span>help</span></a></li>
                        <li class="left"><a href="https://demo.passbolt.com" class="highlighted" target="_blank" rel="noopener"><span>try it!</span></a></li>
                    </ul>
                    <button class="hidden" count="0">more</button>
                    <ul class="hidden-links hidden"></ul>
                </div>
            </nav>
        </div>
    </header>
    <div class="header second">
        <div class="col1">
            <div class="logo no-img">
                <h1><span>Passbolt</span></h1>
            </div>
        </div>
        <div class="col2 search-wrapper">
            <h2 class="visuallyhidden">Help Search</h2>
            <div>
                <form class="search ready" action="/search.html" method="get">
                    <div class="input required">
                        <label for="search-box">Search</label>
                        <input id="search-box" name="query" maxlength="64" placeholder="Help search" class="fuzzy-search" type="search">
                    </div>
                    <button value="search">
                        <i class="fa fa-fw fa-search"></i>
                        <span class="text visuallyhidden">search</span>
                    </button>
                </form>
            </div>
        </div>
        <div class="col3">
            <div class="edit-on-github">
                <a href="https://github.com/passbolt/passbolt_help/edit/master/_posts/hosting/update/2018-05-02-hosting-update-v2.md" class="button">
                    <i class="fa fa-github-alt fa-fw"></i> Edit on github</a>
            </div>
        </div>
    </div>

        <div class="panel main" aria-label="Content">
            <div class="panel left">
                
                







<div class="navigation-help" role="navigation">
    <ul>
        <li>
            <h2>Hosting</h2>
        </li>
        
        <li >
            <a href="https://help.passbolt.com/faq/hosting">Hosting FAQ</a>
        </li>
        
        
        <li >
            <a href="https://help.passbolt.com/hosting/install">Installation</a>
        </li>
        
        
        <li >
            <a href="https://help.passbolt.com/hosting/update">Update</a>
        </li>
        
        
        
        
        <li >
            <a href="https://help.passbolt.com/hosting/upgrade">Upgrade</a>
        </li>
        
        
        <li >
            <a href="https://help.passbolt.com/hosting/backup">Backup</a>
        </li>
        
        
        <li >
            <a href="https://community.passbolt.com/c/installation-issues">Installation issues</a>
        </li>
        
        
    </ul>
</div>










                
            </div>
            <div class="panel middle" data-spy="scroll" data-target=".scrollspy">
                <div class="grid grid-responsive-12">
                    <article>
                        <div class="row" id="introduction">
    <div class="col12">
        <div class="breadcrumbs">
            <ul>
                <li>
                    <div class="main-cell">
                        <a href="https://www.passbolt.com"><span>home</span></a>
                    </div>
                </li>
                <li>
                    <div class="main-cell">
                        <a href="/"><span>help</span></a>
                    </div>
                </li>
                
                
                <li>
                    <div class="main-cell">
                        <a href="https://help.passbolt.com/hosting"><span>hosting</span></a>
                    </div>
                </li>
                <li>
                    <div class="main-cell">
                        <a href="https://help.passbolt.com/hosting/update"><span>update</span></a>
                    </div>
                </li>
                
                
                
                <li>
                    <div class="main-cell">
                        <a href="https://help.passbolt.com/hosting/update/install-scripts.html"><span>install_scripts</span></a>
                    </div>
                </li>
                
            </ul>
        </div>
    </div>
</div>

                        <div class="row" markdown="1">
<div class="col7" markdown="1">
<h1>Update passbolt server component (v2)</h1>
</div>
</div>

                        <div class="row">
  <div class="col7">

    <h1 id="pre-requisites">Pre-requisites</h1>

    <h2 id="find-out-where-is-your-passbolt-directory">Find out where is your passbolt directory</h2>

    <p>All the commands hereafter should be done from inside your passbolt directory:</p>
    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span><span class="nb">cd</span> /var/www/passbolt
</code></pre></div>    </div>

    <p>By default passbolt should be installed under <code class="language-plaintext highlighter-rouge">/var/www/passbolt</code> but it could be different if you
installed from source manually. We will assume for the rest of this tutorial that it is located
in <code class="language-plaintext highlighter-rouge">/var/www/passbolt</code>.</p>

    <h2 id="find-out-the-name-of-your-webserver-user">Find out the name of your webserver user</h2>

    <p>Some commands need to be run as the same user running the web server. Generally on Debian systems it will be
<code class="language-plaintext highlighter-rouge">www-data</code> but on other distributions like Centos it could be for example <code class="language-plaintext highlighter-rouge">nginx</code> or <code class="language-plaintext highlighter-rouge">http</code>.
For the rest of this tutorial we will assume that the user named <code class="language-plaintext highlighter-rouge">www-data</code>.</p>

    <p>Generally it is not possible to login as this user, so in order to run the command as this user,
you can execute something like this:</p>

    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span><span class="nb">sudo</span> <span class="nt">-H</span> <span class="nt">-u</span> www-data bash <span class="nt">-c</span> <span class="s2">"./bin/cake passbolt healthcheck"</span>
</code></pre></div>    </div>

    <p>This command for example, will run the healthcheck command as <code class="language-plaintext highlighter-rouge">www-data</code> data user.
It is a good idea to start with running a healthcheck prior to updating, to make sure everything is in order.</p>

    <h2 id="make-sure-the-permissions-are-right-for-your-current-user">Make sure the permissions are right for your current user</h2>

    <div class="message warning">
    <p>
        Do not run the commands as root when updating passbolt. It can render your installation unusable.
    </p>
    
</div>

    <p>Running commands as root can make your installation unusable until the permissions are repaired.
We recommend you use another user for this purpose. The <code class="language-plaintext highlighter-rouge">whoami</code> command will let you know which user you are logged
in as. In our case below, it is the user <code class="language-plaintext highlighter-rouge">passbolt</code>.</p>
    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span><span class="nb">whoami
</span>passbolt
</code></pre></div>    </div>

    <p>You need to make sure that this user have access to the passbolt directory.
The easiest way to do this would be to add such user to the <code class="language-plaintext highlighter-rouge">www-data</code> and <code class="language-plaintext highlighter-rouge">sudo</code> groups,
so for example for a <code class="language-plaintext highlighter-rouge">passbolt</code> user, you could execute as root:</p>

    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span><span class="nb">sudo </span>usermod <span class="nt">-a</span> <span class="nt">-G</span> www-data passbolt
<span class="nv">$ </span><span class="nb">sudo </span>usermod <span class="nt">-a</span> <span class="nt">-G</span> <span class="nb">sudo </span>passbolt
</code></pre></div>    </div>

    <p>You can check if the user is included in the group (you may need to logout / login again for the permissions to be
applied):</p>
    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span><span class="nb">groups </span>passbolt
passbolt : passbolt www-data <span class="nb">sudo</span>
</code></pre></div>    </div>

    <p>Make sure the passbolt directory is owned by the passbolt user and accessible to the www-data group.
You can set the permissions as follow:</p>

    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span><span class="nb">sudo chown</span> <span class="nt">-R</span> passbolt:www-data <span class="nb">.</span>
<span class="nv">$ </span><span class="nb">sudo chmod</span> <span class="nt">-R</span> o-rwx <span class="nb">.</span>
<span class="nv">$ </span><span class="nb">sudo </span>find <span class="nb">.</span> <span class="nt">-type</span> d <span class="nt">-print0</span> | xargs <span class="nt">-0</span> <span class="nb">sudo chmod </span>g-w
<span class="nv">$ </span><span class="nb">sudo </span>find <span class="nb">.</span> <span class="nt">-type</span> f <span class="nt">-print0</span> | xargs <span class="nt">-0</span> <span class="nb">sudo chmod </span>g-wx
<span class="nv">$ </span><span class="nb">sudo chmod </span>g+x ./bin/cake
<span class="nv">$ </span><span class="nb">sudo </span>find ./tmp <span class="nt">-type</span> d <span class="nt">-print0</span> | xargs <span class="nt">-0</span> <span class="nb">sudo chmod </span>770
<span class="nv">$ </span><span class="nb">sudo </span>find ./tmp <span class="nt">-type</span> f <span class="nt">-print0</span> | xargs <span class="nt">-0</span> <span class="nb">sudo chmod </span>660
<span class="nv">$ </span><span class="nb">sudo </span>find ./logs <span class="nt">-type</span> d <span class="nt">-print0</span> | xargs <span class="nt">-0</span> <span class="nb">sudo chmod </span>770
<span class="nv">$ </span><span class="nb">sudo </span>find ./logs <span class="nt">-type</span> f <span class="nt">-print0</span> | xargs <span class="nt">-0</span> <span class="nb">sudo chmod </span>660
<span class="nv">$ </span><span class="nb">sudo </span>find ./webroot/img/public <span class="nt">-type</span> d <span class="nt">-print0</span> | xargs <span class="nt">-0</span> <span class="nb">sudo chmod </span>770
<span class="nv">$ </span><span class="nb">sudo </span>find ./webroot/img/public <span class="nt">-type</span> f <span class="nt">-print0</span> | xargs <span class="nt">-0</span> <span class="nb">sudo chmod </span>660
</code></pre></div>    </div>

    <p>Check that the permissions are set as expected.</p>
    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span><span class="nb">ls</span> <span class="nt">-la</span> <span class="nb">.</span>
drwxr-x--- 2 passbolt www-data  <span class="nb">.</span>
drwx------ 6 root root          ..
drwxr-x--- 6 passbolt www-data  config
</code></pre></div>    </div>

    <p>Make sure the passbolt directory doesn‚Äôt contain any changes. If you have altered the passbolt code, stash your changes
before executing the following command.</p>
    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>git checkout HEAD <span class="nb">.</span>
</code></pre></div>    </div>

    <h2 id="check-if-git-and-composer-are-present-on-your-system">Check if git and composer are present on your system</h2>

    <p>By default you should have both composer and git installed:</p>
    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>which git
/usr/bin/git
</code></pre></div>    </div>

    <p>You should also already have composer installed.</p>
    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>which composer.phar
/usr/bin/composer.phar
</code></pre></div>    </div>

    <p>Depending on your setup it is possible that your composer command is named <code class="language-plaintext highlighter-rouge">composer</code> and not <code class="language-plaintext highlighter-rouge">composer.phar</code>.</p>

    <p>If for some reason the command above fails because you don‚Äôt have composer installed,
you can check the <a href="https://getcomposer.org/download/">composer installation instructions</a>.</p>

    <h1 id="updating-passbolt">Updating passbolt</h1>
    <h2 id="take-down-your-site">0. Take down your site</h2>

    <p>It is generally a good idea to stop running the site prior to the upgrade. This is to avoid having side effects
such as active users corrupting the data in the middle of an upgrade. For example if you are using <code class="language-plaintext highlighter-rouge">nginx</code> as a
webserver:</p>
    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span><span class="nb">sudo </span>systemctl stop nginx
</code></pre></div>    </div>

    <p>If you feel a bit more fancy, you can change your web server configuration to point to an ‚Äúunder maintenance‚Äù page.
It is a good practice to announce such maintenance window to your users in advance, so that they can also
plan for the update, for example by downloading some key passwords they may need.</p>

    <h2 id="get-the-latest-code-version">1. Get the latest code version</h2>

    <p>You can also pull the latest version directly from master:</p>
    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>git pull origin master
</code></pre></div>    </div>

    <p>To pull a specific version you can do:</p>
    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>git fetch origin tags/v2.13.0
<span class="nv">$ </span>git checkout tags/v2.13.0
</code></pre></div>    </div>

    <p>On installations based on install scripts or in the VM appliance you are in a shallow clone state so to change
the branch you will need to:</p>

    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>git remote set-branches origin <span class="s2">"*"</span>
<span class="nv">$ </span>git fetch origin tags/v2.13.0
<span class="nv">$ </span>git checkout tags/v2.13.0
</code></pre></div>    </div>

    <h2 id="update-the-dependencies">2. update the dependencies</h2>

    <p>Some libraries are not packaged with the software but need to be updated using composer, based on
what is recommended in the composer.lock. This file is provided by passbolt.</p>

    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>php <span class="nt">-d</span> <span class="nv">allow_url_fopen</span><span class="o">=</span>on /usr/bin/composer.phar <span class="nb">install</span> <span class="nt">--no-dev</span> <span class="nt">-n</span> <span class="nt">-o</span>
</code></pre></div>    </div>

    <h2 id="run-the-migration-script">3. Run the migration script</h2>

    <p>You can run the database migration scripts as follow:</p>
    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span><span class="nb">sudo</span> <span class="nt">-H</span> <span class="nt">-u</span> www-data bash <span class="nt">-c</span> <span class="s2">"./bin/cake passbolt migrate --backup"</span>
</code></pre></div>    </div>

    <p>As you can see with the command above you can optional ask the application to create a database backup.
This is useful in case you run into any issues with the new version and need to revert to an old but working one.</p>

    <p>This backup will be placed in <code class="language-plaintext highlighter-rouge">./tmp/cache/database/backup/backup_timestamp.sql</code>.</p>

    <h2 id="clear-the-cache">4. Clear the cache</h2>

    <p>Finally make sure you clear the application cache, to make sure any changes in the database structure are
reflected in model cache files:</p>
    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span><span class="nb">sudo</span> <span class="nt">-H</span> <span class="nt">-u</span> www-data bash <span class="nt">-c</span> <span class="s2">"./bin/cake cache clear_all"</span>
</code></pre></div>    </div>

    <h2 id="take-your-site-back-up">5. Take your site back up</h2>

    <p>Almost done:</p>
    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">sudo </span>systemctl start nginx
</code></pre></div>    </div>

    <h2 id="troubleshooting">Troubleshooting</h2>

    <h4 id="verifying-the-status-of-the-application">Verifying the status of the application</h4>
    <p>Optionally, you can login as an administrator and check the status on the healthcheck page:</p>

    <figure>
    <img src="https://help.passbolt.com/assets/img/screenshots/AD_healthcheck.jpg" alt="Example of healthcheck screen" style="max-width:;" />
    <span class="legend">fig. Example of healthcheck screen</span>
</figure>

    <p>You can also run the following command:</p>
    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span><span class="nb">sudo</span> <span class="nt">-H</span> <span class="nt">-u</span> www-data bash <span class="nt">-c</span> <span class="s2">"./bin/cake passbolt healthcheck"</span>
</code></pre></div>    </div>

    <h4 id="if-you-run-into-some-issues">If you run into some issues</h4>

    <p>If you run into some issues:</p>
    <ul>
      <li>Make a copy or screenshot of the errors messages displayed on the screen</li>
      <li>Check for error message in the <code class="language-plaintext highlighter-rouge">logs</code> directory</li>
      <li>Check for error message in the browser console</li>
      <li>Checkout the previous working version using git</li>
      <li>Drop the database and load your backup data to restore to a previously working version</li>
      <li>Note down the the details of you environment: your OS, php, mysql environment versions.</li>
    </ul>

    <p>Where to get help:</p>
    <ul>
      <li>If you are a Passbolt Pro Edition subscriber send us an <a href="mailto:contact@passbolt.com">email</a> with the details.</li>
      <li>If you are a Passbolt Community Edition user you can open new thread on the <a href="https://community.passbolt.com/c/installation-issues">community forum</a>.</li>
    </ul>

    <p>The more information you provide about what you did, what you tried, how your environment look like,
the easiest it will be for people to help you.</p>

    <div class="last-updated">
      <h3>Last updated</h3>
      <p>This article was last updated on 
June
25th,
2020.</p>
    </div>

  </div>
  <div class="col4 last push1">

    <div class="message tldr">
    <p>Are you still using passbolt v1? Check out the previous version of this article.</p>
    
    <a href="/hosting/update-v1" class="button ">See previous version</a>
    
</div>

    <div class="message tldr notice">
    <p>Are you experiencing issues when updating passbolt?</p>
    
    <a href="https://community.passbolt.com/c/installation-issues" class="button primary">Ask the community!</a>
    
</div>

    <div class="message ">
    <p></p>
    
</div>

  </div>
</div>

                    </article>
                </div>
            </div>
        </div>
            <footer>
        <div class="footer">
            <ul class="footer-links">
                <li><a href="https://www.passbolt.com/licence">Terms</a></li>
                <li><a href="https://www.passbolt.com/privacy">Privacy</a></li>
                <li><a href="https://www.passbolt.com/credits">Credits</a></li>
                <li><a href="https://careers.passbolt.com">Careers</a></li>
            </ul>
        </div>
    </footer>
    <div id="cookies-eu-banner" class="visually-hidden">
        üç™ &nbsp; Do you accept cookies for statistical purposes?
        <a href="https://www.passbolt.com/privacy" id="cookies-eu-more">(Read more)</a>
        <a class="button primary" id="cookies-eu-accept">Accept</a>
        <a id="cookies-eu-reject">No thanks!</a>
    </div>


    </div>
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-23506466-3"></script>
<script src="https://code.jquery.com/jquery-3.5.0.slim.min.js" integrity="sha384-/IFzzQmt1S744I+IQO4Mc1uphkxbXt1tEwjQ/qSw2p8pXWck09sLvqHmKDYYwReJ" crossorigin="anonymous"></script>
<script src="https://help.passbolt.com/assets/js/cookies-eu-banner.js"></script>
<script src="https://help.passbolt.com/assets/js/analytics.js"></script>
<script src="https://help.passbolt.com/assets/js/greedynav.js"></script>
</body>

</html>