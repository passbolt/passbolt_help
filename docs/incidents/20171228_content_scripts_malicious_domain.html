<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>Passbolt Help | Content scripts running on malicious domain</title>
    <!--
             ____                  __          ____
            / __ \____  _____ ____/ /_  ____  / / /_
           / /_/ / __ `/ ___/ ___/ __ \/ __ \/ / __/
          / ____/ /_/ (__  |__  ) /_/ / /_/ / / /_
         /_/    \__,_/____/____/_.___/\____/_/\__/

         Open source password manager for teams
         ¬© 2019 Passbolt SA

     -->
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="Summary">
    <meta property="og:image" content="https://help.passbolt.com/assets/img/background/og_preview.jpg" />
    <meta property="og:title" content="Content scripts running on malicious domain" />
    <meta property="og:description" content="Summary" />
    <link rel="stylesheet" href="https://help.passbolt.com/assets/css/help.min.css">
    <link rel="stylesheet" href="https://help.passbolt.com/assets/css/highlight.css">
    <link rel="stylesheet" href="https://help.passbolt.com/assets/css/cookie-eu-banner.css">
    <link rel="stylesheet" href="https://help.passbolt.com/assets/css/custom.css">
    <link rel="canonical" href="https://help.passbolt.com/incidents/20171228_content_scripts_malicious_domain">
    <link rel="shortcut icon" type="image/x-icon" href="https://help.passbolt.com/assets/favicon.ico" />
    <link rel="alternate" type="application/rss+xml" title="Passbolt | Help" href="https://help.passbolt.com/feed.xml">
</head>


<body>
    <div id="container" class="help page background">
            <header>
        <div class="header first ">
            <nav class="greedy">
                <div class="top navigation primary">
                    <ul class="links clearfix">
                        <li class="home with-text"><a href="http://www.passbolt.com/"><span>home</span></a></li>
                        <li class="left"><a href="https://www.passbolt.com/services"><span>pricing</span></a></li>
                        <li class="left"><a href="https://www.passbolt.com/roadmap"><span>roadmap</span></a></li>
                        <li class="left"><a href="https://community.passbolt.com/"><span>forum</span></a></li>
                        <li class="left"><a href="https://www.passbolt.com/blog"><span>blog</span></a></li>
                        <li class="left selected"><a href="https://help.passbolt.com/"><span>help</span></a></li>
                        <li class="left"><a href="https://demo.passbolt.com" class="highlighted" target="_blank" rel="noopener"><span>try it!</span></a></li>
                    </ul>
                    <button class="hidden" count="0">more</button>
                    <ul class="hidden-links hidden"></ul>
                </div>
            </nav>
        </div>
    </header>
    <div class="header second">
        <div class="col1">
            <div class="logo no-img">
                <h1><span>Passbolt</span></h1>
            </div>
        </div>
        <div class="col2 search-wrapper">
            <h2 class="visuallyhidden">Help Search</h2>
            <div>
                <form class="search ready" action="/search.html" method="get">
                    <div class="input required">
                        <label for="search-box">Search</label>
                        <input id="search-box" name="query" maxlength="64" placeholder="Help search" class="fuzzy-search" type="search">
                    </div>
                    <button value="search">
                        <i class="fa fa-fw fa-search"></i>
                        <span class="text visuallyhidden">search</span>
                    </button>
                </form>
            </div>
        </div>
        <div class="col3">
            <div class="edit-on-github">
                <a href="https://github.com/passbolt/passbolt_help/edit/master/_incidents/2017-12-28-content-scripts-malicious-domain.md" class="button">
                    <i class="fa fa-github-alt fa-fw"></i> Edit on github</a>
            </div>
        </div>
    </div>

        <div class="panel main" aria-label="Content">
            <div class="panel left">
                <div class="navigation-help" role="navigation">
    <ul>
        <li><h2>Incidents</h2></li>

        
        <li>
        
            <a href="/incidents">All incidents</a>
        </li>

        
        
        
        <li>
        
            <a href="https://help.passbolt.com/incidents/reflective-html-injection-vulnerability">
April
17th,
2024
</a>
        </li>
        
        
        <li>
        
            <a href="https://help.passbolt.com/incidents/pwned-password-service-information-leak">
April
17th,
2024
</a>
        </li>
        
        
        <li>
        
            <a href="https://help.passbolt.com/incidents/20240415_PBL-11-security-audit-results">
April
15th,
2024
</a>
        </li>
        
        
        <li>
        
            <a href="https://help.passbolt.com/incidents/20230911_PBL-09-security-audit-results">
September
11th,
2023
</a>
        </li>
        
        
        <li>
        
            <a href="https://help.passbolt.com/incidents/20230710_PBL-08-security-audit-results">
July
10th,
2023
</a>
        </li>
        
        
        <li>
        
            <a href="https://help.passbolt.com/incidents/20230701_cloud-outage">
July
3rd,
2023
</a>
        </li>
        
        
        <li>
        
            <a href="https://help.passbolt.com/incidents/20230426_sending-unencrypted-description">
April
26th,
2023
</a>
        </li>
        
        
        <li>
        
            <a href="https://help.passbolt.com/incidents/20230404_android-app-unlisted">
April
5th,
2023
</a>
        </li>
        
        
        <li>
        
            <a href="https://help.passbolt.com/incidents/20220920_spell-jacking">
September
20th,
2022
</a>
        </li>
        
        
        <li>
        
            <a href="https://help.passbolt.com/incidents/220220118_PBL-06-security-audit-results">
January
19th,
2022
</a>
        </li>
        
        
        <li>
        
            <a href="https://help.passbolt.com/incidents/220211215_Clout-outage">
December
15th,
2021
</a>
        </li>
        
        
        <li>
        
            <a href="https://help.passbolt.com/incidents/20211124_PBL_06_008_v331_Cure53_report">
November
24th,
2021
</a>
        </li>
        
        
        <li>
        
            <a href="https://help.passbolt.com/incidents/20210419_PBL01_Cure53_report">
October
19th,
2021
</a>
        </li>
        
        
        <li>
        
            <a href="https://help.passbolt.com/incidents/20210210_v3_webextension_issues">
February
10th,
2021
</a>
        </li>
        
        
        <li>
        
            <a href="https://help.passbolt.com/incidents/20191126_autofill_suggestions">
November
26th,
2019
</a>
        </li>
        
        
        <li>
        
            <a href="https://help.passbolt.com/incidents/20190807_multiple_vulnerabilities">
August
7th,
2019
</a>
        </li>
        
        
        <li>
        
            <a href="https://help.passbolt.com/incidents/20190211_multiple_vulnerabilities">
February
11th,
2019
</a>
        </li>
        
        
        <li>
        
            <a href="https://help.passbolt.com/incidents/20181109_gke_incident">
November
9th,
2018
</a>
        </li>
        
        
        <li>
        
            <a href="https://help.passbolt.com/incidents/20180509_nginx_webroot_configuration">
May
9th,
2018
</a>
        </li>
        
        
        <li>
        
            <a href="https://help.passbolt.com/incidents/20180508_password_generator_prng">
May
8th,
2018
</a>
        </li>
        
        
        <li class="selected">
        
            <a href="https://help.passbolt.com/incidents/20171228_content_scripts_malicious_domain">
December
28th,
2017
</a>
        </li>
        
        
        <li>
        
            <a href="https://help.passbolt.com/incidents/20171013_passphrase_information_leakage">
October
13th,
2017
</a>
        </li>
        
        
        <li>
        
            <a href="https://help.passbolt.com/incidents/20170914_xss_on_resource_urls">
September
14th,
2017
</a>
        </li>
        
        
        <li>
        
            <a href="https://help.passbolt.com/incidents/20170210_chrome_not_available">
February
10th,
2017
</a>
        </li>
        

    </ul>
</div>

            </div>
            <div class="panel middle" data-spy="scroll" data-target=".scrollspy">
                <div class="grid grid-responsive-12">
                    <article>
                        <div class="row" id="introduction">
    <div class="col12">
        <div class="breadcrumbs">
            <ul>
                <li>
                    <div class="main-cell">
                        <a href="https://www.passbolt.com"><span>home</span></a>
                    </div>
                </li>
                <li>
                    <div class="main-cell">
                        <a href="/"><span>help</span></a>
                    </div>
                </li>
                
                
                <li>
                    <div class="main-cell">
                        <a href="https://help.passbolt.com/incidents"><span>incidents</span></a>
                    </div>
                </li>
                
                
                
                
                <li>
                    <div class="main-cell">
                        <a href="https://help.passbolt.com/incidents/20171228_content_scripts_malicious_domain"><span>2017-12-28 Content scripts malicious domain</span></a>
                    </div>
                </li>
                
            </ul>
        </div>
    </div>
</div>

                        <div class="row" markdown="1">
<div class="col7" markdown="1">
<h1>Content scripts running on malicious domain</h1>
</div>
</div>

                        <div class="row">
  <div class="col7">
    <h2 id="summary">Summary</h2>

    <p>Passbolt Web Extension version 1.6.7 is vulnerable to content scripts that can run on untrusted malicious domain.</p>

    <ul>
      <li><strong>CVE:</strong> N/A.</li>
      <li><strong>Product affected:</strong> Passbolt Browser Extension.</li>
      <li><strong>Version affected:</strong> v1.6.7 and below.</li>
      <li><strong>Version fixed:</strong> v1.6.8.</li>
      <li><strong>Affected component:</strong> Content script injection component (pagemod constructor).</li>
      <li><strong>Vulnerability Type:</strong> Business logic vulnerability.</li>
      <li><strong>Severity:</strong> Medium (4.2).</li>
    </ul>

    <h3 id="impact-of-issue">Impact of issue</h3>

    <p>The integrity of passwords can be affected if the user is already logged in on the trusted domain. The confidentiality 
of passwords is not affected unless the attacker manages to add himself as a user on the victim server and trick the 
victim into sharing a password with the attacker. The confidentiality of the private key or the passphrase is not affected.</p>

    <h3 id="attack-vector--exploitation">Attack vector / exploitation</h3>

    <p>Since the application does not escape special characters such as ‚Äò.‚Äô when building the regular expression to check if a 
given domain in trusted, an attacker can register a malicious site such as ‚Äòdemoxpassbolt.com‚Äô to target a user of 
‚Äòdemo.passbolt.com‚Äô. This malicious site will be considered as trusted by the extension.</p>

    <p>Authentication content script: The attacker could bypass the server key verification step of the authentication process 
and display the login form on the untrusted domain and get the user to log in on the trusted domain. The attacker then 
needs to prevent the web extension to redirect the user to the trusted domain.</p>

    <p>Application content script: If the user is logged in on the trusted domain and visiting the untrusted domain, the 
attacker can use this trust to trick the user into performing privileged actions (e.g. open a share window, decrypt 
and copy a password to the clipboard, etc.).</p>

    <h3 id="credits">Credits</h3>

    <p>This issue was found and reported by Wladimir Palant.</p>

    <h2 id="other-information">Other information</h2>

    <h3 id="how-did-you-fix-this">How did you fix this?</h3>

    <p>Following the issue reporter proposal passbolt now escapes non letter characters in the users.settings.domain url stored in the extension.</p>
    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>var escapedDomain = user.settings.getDomain().replace(/\W/g, "\\$&amp;");
var url = '^' + escapedDomain + '/auth/login/?(#.*)?$';
var regex = new RegExp(url);
</code></pre></div>    </div>

    <h3 id="is-passbolt-server-key-verification-a-placebo">Is passbolt server key verification a placebo?</h3>

    <p>Additional discussion on the utility and expectations created by the use of passbolt of the GpgAuth verify step can be 
found <a href="https://community.passbolt.com/t/is-server-authentication-a-placebo-gpgauth-verify-step-usage-in-passbolt/212">here</a>.</p>

    <h3 id="event-timeline">Event timeline</h3>

    <ul>
      <li>2017-12-27 08:13 PM CET: Vulnerability details sent by reporter.</li>
      <li>2017-12-28 05:49 AM CET: We acknowledge the issue, start working on a fix and start looking for similar issues in other part of the code.</li>
      <li>2017-12-28 08:19 AM CET: We release a fix on passbolt development repository and start testing with continuous integration tools.</li>
      <li>2017-12-28 02:15 PM CET: We deploy a fix on chrome and firefox web extension stores.</li>
      <li>2017-12-28 03:00 PM CET: We notify the reporter that a fix has been deployed.</li>
      <li>2017-12-28 03:30 PM CET: We publish the fix on github, the release notes and this report.</li>
    </ul>

    <div class="last-updated">
      <h3>Last updated</h3>
      <p>This article was last updated on 
December
28th,
2017.</p>
    </div>
  </div>
  <div class="col4 last push1">

    <div class="tldr message success">
    <h4>Current status:</h4>
    1. Try first to reproduce the issue<br />
    2. Acknowledge to the reporter<br />
    3. Get a fix/patch prepared<br />
    4. Release new version.<br />
    5. Prepare a report about the issue.<br />
    <strong>6. Feature the problem in the release.</strong>
    <h5>Last updated: 2017-12-28 15:30:00 CET</h5>
</div>

  </div>
</div>

                    </article>
                </div>
            </div>
        </div>
            <footer>
        <div class="footer">
            <ul class="footer-links">
                <li><a href="https://www.passbolt.com/licence">Terms</a></li>
                <li><a href="https://www.passbolt.com/privacy">Privacy</a></li>
                <li><a href="https://www.passbolt.com/credits">Credits</a></li>
                <li><a href="https://careers.passbolt.com">Careers</a></li>
            </ul>
        </div>
    </footer>
    <div id="cookies-eu-banner" class="visually-hidden">
        üç™ &nbsp; Do you accept cookies for statistical purposes?
        <a href="https://www.passbolt.com/privacy" id="cookies-eu-more">(Read more)</a>
        <a class="button primary" id="cookies-eu-accept">Accept</a>
        <a id="cookies-eu-reject">No thanks!</a>
    </div>


    </div>
    <script src="https://consent.cookiebot.com/uc.js" data-cbid="900808a8-f178-4994-b2ad-66bf3ccca5f7" data-blockingmode="auto" strategy="beforeInteractive"></script>
<script src="https://help.passbolt.com/assets/js/matomo-tag-manager.js"></script>
<script src="https://help.passbolt.com/assets/js/matomo-analytics.js"></script>
<script src="https://code.jquery.com/jquery-3.5.0.slim.min.js" integrity="sha384-/IFzzQmt1S744I+IQO4Mc1uphkxbXt1tEwjQ/qSw2p8pXWck09sLvqHmKDYYwReJ" crossorigin="anonymous"></script>
<script src="https://help.passbolt.com/assets/js/analytics.js"></script>
<script src="https://help.passbolt.com/assets/js/greedynav.js"></script>
</body>

</html>