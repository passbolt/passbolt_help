<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>Passbolt Help | Configure LDAP plugin with SSL (ldaps)</title>
    <!--
             ____                  __          ____
            / __ \____  _____ ____/ /_  ____  / / /_
           / /_/ / __ `/ ___/ ___/ __ \/ __ \/ / __/
          / ____/ /_/ (__  |__  ) /_/ / /_/ / / /_
         /_/    \__,_/____/____/_.___/\____/_/\__/

         Open source password manager for teams
         ¬© 2019 Passbolt SA

     -->
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="">
    <meta property="og:image" content="https://help.passbolt.com/assets/img/help/2018/09/AD_ldap_overview.png" />
    <meta property="og:title" content="Configure LDAP plugin with SSL (ldaps)" />
    <meta property="og:description" content="" />
    <link rel="stylesheet" href="https://help.passbolt.com/assets/css/help.min.css">
    <link rel="stylesheet" href="https://help.passbolt.com/assets/css/highlight.css">
    <link rel="stylesheet" href="https://help.passbolt.com/assets/css/cookie-eu-banner.css">
    <link rel="canonical" href="https://help.passbolt.com/configure/ldap/ldap-with-ssl">
    <link rel="shortcut icon" type="image/x-icon" href="https://help.passbolt.com/assets/favicon.ico" />
    <link rel="alternate" type="application/rss+xml" title="Passbolt | Help" href="https://help.passbolt.com/feed.xml">

</head>


<body>
    <div id="container" class="help page background">
            <header>
        <div class="header first ">
            <nav class="greedy">
                <div class="top navigation primary">
                    <ul class="links clearfix">
                        <li class="home with-text"><a href="http://www.passbolt.com/"><span>home</span></a></li>
                        <li class="left"><a href="https://www.passbolt.com/services"><span>pricing</span></a></li>
                        <li class="left"><a href="https://www.passbolt.com/roadmap"><span>roadmap</span></a></li>
                        <li class="left"><a href="https://community.passbolt.com/"><span>forum</span></a></li>
                        <li class="left"><a href="https://www.passbolt.com/blog"><span>blog</span></a></li>
                        <li class="left selected"><a href="https://help.passbolt.com/"><span>help</span></a></li>
                        <li class="left"><a href="https://demo.passbolt.com" class="highlighted" target="_blank" rel="noopener"><span>try it!</span></a></li>
                    </ul>
                    <button class="hidden" count="0">more</button>
                    <ul class="hidden-links hidden"></ul>
                </div>
            </nav>
        </div>
    </header>
    <div class="header second">
        <div class="col1">
            <div class="logo no-img">
                <h1><span>Passbolt</span></h1>
            </div>
        </div>
        <div class="col2 search-wrapper">
            <h2 class="visuallyhidden">Help Search</h2>
            <div>
                <form class="search ready" action="/search.html" method="get">
                    <div class="input required">
                        <label for="search-box">Search</label>
                        <input id="search-box" name="query" maxlength="64" placeholder="Help search" class="fuzzy-search" type="search">
                    </div>
                    <button value="search">
                        <i class="fa fa-fw fa-search"></i>
                        <span class="text visuallyhidden">search</span>
                    </button>
                </form>
            </div>
        </div>
        <div class="col3">
            <div class="edit-on-github">
                <a href="https://github.com/passbolt/passbolt_help/edit/master/_posts/configure/2020-01-10-configure-ldap-ssl.md" class="button">
                    <i class="fa fa-github-alt fa-fw"></i> Edit on github</a>
            </div>
        </div>
    </div>

        <div class="panel main" aria-label="Content">
            <div class="panel left">
                
                









<div class="navigation-help" role="navigation">
    <ul>
        <li>
            <h2>Configure</h2>
        </li>
        
        <li >
            <a href="https://help.passbolt.com/configure/ldap/setup">Configure LDAP</a>
        </li>
        
        
        
        
        <li >
            <a href="https://help.passbolt.com/configure/mfa/yubikey">Configure Yubikey</a>
        </li>
        
        
        <li >
            <a href="https://help.passbolt.com/configure/mfa/duo">Configure Duo</a>
        </li>
        
        
        <li >
            <a href="https://help.passbolt.com/configure/notification/email">Configure Email Notifications</a>
        </li>
        
        
        <li class="selected"
            >
            <a href="https://help.passbolt.com/configure/ldap/ldap-with-ssl">Configure LDAP with ssl</a>
        </li>
        
        
        <li class="selected"
            >
            <a href="https://help.passbolt.com/configure/ldap/ldap-common-sync-error-messages">Troubleshoot LDAP sync errors</a>
        </li>
        
        
        <li >
            <a href="https://help.passbolt.com/configure/environment/reference">Environment variable reference</a>
        </li>
        
        
        <li >
            <a href="https://help.passbolt.com/configure/email/setup">Configure Email providers</a>
        </li>
        
        
        <li >
            <a href="https://help.passbolt.com/configure/https">Configure HTTPS</a>
        </li>
        
        
        <li >
            <a href="https://help.passbolt.com/faq/hosting/why-email-not-sent">Troobleshoot Email config</a>
        </li>
        
        
    </ul>
</div>








                
            </div>
            <div class="panel middle" data-spy="scroll" data-target=".scrollspy">
                <div class="grid grid-responsive-12">
                    <article>
                        <div class="row" id="introduction">
    <div class="col12">
        <div class="breadcrumbs">
            <ul>
                <li>
                    <div class="main-cell">
                        <a href="https://www.passbolt.com"><span>home</span></a>
                    </div>
                </li>
                <li>
                    <div class="main-cell">
                        <a href="/"><span>help</span></a>
                    </div>
                </li>
                
                
                <li>
                    <div class="main-cell">
                        <a href="https://help.passbolt.com/configure"><span>configure</span></a>
                    </div>
                </li>
                <li>
                    <div class="main-cell">
                        <a href="https://help.passbolt.com/configure/ldap"><span>ldap</span></a>
                    </div>
                </li>
                
                
                
                <li>
                    <div class="main-cell">
                        <a href="https://help.passbolt.com/configure/ldap/ldap-with-ssl.html"><span>ldap-with-ssl</span></a>
                    </div>
                </li>
                
            </ul>
        </div>
    </div>
</div>

                        <div class="row" markdown="1">
<div class="col7" markdown="1">
<h1>Configure LDAP plugin with SSL (ldaps)</h1>
</div>
</div>

                        <div class="row">
  <div class="col7">

    <h2 id="introduction">Introduction</h2>

    <p>To run LDAPS your LDAP server must offer a valid SSL certificate to the client which in this case that client is the passbolt server.
It is also required that the SSL certificate is trusted by your passbolt instance.</p>

    <p>There are two ways of obtaining your SSL certificate, listed below.</p>

    <h3 id="your-ldap-server-is-offering-a-ssl-certificate-obtained-by-a-public-certificate-authority">Your LDAP server is offering a SSL certificate obtained by a public Certificate Authority</h3>

    <p>If your SSL certificate has been obtained through a public and well known SSL certificate authority such as <a href="https://letsencrypt.org/">Let‚Äôs encrypt</a> your certificate would
be automatically trusted by the passbolt instance unless otherwise specified by your SSL provider.</p>

    <p>Most of the time in this scenario your passbolt instance will not require any extra configuration.</p>

    <h3 id="your-ldap-server-is-offering-a-ssl-certificate-obtained-from-a-private-certficate-authority">Your LDAP server is offering a SSL certificate obtained from a private Certficate Authority</h3>

    <p>Some organizations run LDAP on a private network on premises. In these scenarios it is very common that your organization has a private SSL certificate authority that
generates SSL certificates valid only on the private network.</p>

    <p>If this is your scenario you probably will need a CA certificate to trust the private SSL certificate offered by your LDAP server if the LDAP SSL certificate is not chained correctly.</p>

    <p>If the LDAP SSL certificate is not chained correctly meaning that it is not offering both the CA certificate and SSL certificate on connection you must obtain and upload the CA certificate
to your passbolt instance.</p>

    <figure>
    <img src="https://help.passbolt.com/assets/img/help/2020/01/AD_ldaps_ssl_certificate_error.png" alt="LDAP with ssl - certificate error message" style="max-width:660px;" />
    <span class="legend">fig. LDAP with ssl - certificate error message</span>
</figure>

    <h2 id="configure-passbolt-server-to-trust-a-private-ldaps-certificate">Configure passbolt server to trust a private LDAPS certificate</h2>

    <h3 id="step-1-ping-the-server">Step 1: ping the server</h3>

    <p>The first step is to understand what is causing the issue and be sure that it‚Äôs related to a certificate issue.</p>

    <p>We first try to ping the server and see if it goes through.</p>

    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ping your_ldap_server.com
</code></pre></div>    </div>

    <p>If it does not go through, check that there is a corresponding entry for your domain / server ip in <code class="language-plaintext highlighter-rouge">/etc/hosts</code>. If it‚Äôs not there add it.</p>

    <p>If it goes through, we will then try to execute a similar ldap query to what passbolt does using ldapsearch.</p>

    <h3 id="step-2-connect-with-ldapsearch">Step 2: Connect with ldapsearch</h3>

    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ldapsearch <span class="nt">-x</span> <span class="nt">-D</span> <span class="s2">"username"</span> <span class="nt">-W</span> <span class="nt">-H</span> ldaps://your_ldap_server.com <span class="nt">-b</span> <span class="s2">"dc=domain,dc=com"</span> <span class="nt">-d</span> 9
</code></pre></div>    </div>

    <p>Do not forget to replace the ‚Äòusername‚Äô, ‚Äòyour_ldap_server.com‚Äô ‚Äòdomain‚Äô and ‚Äòcom‚Äô variables with the real ones.</p>

    <p>If after this command is executed you see your objects returned, it means that the LDAPS connection is going through and that
there must be an issue with the parameters you entered in passbolt LDAP plugin. You should check them again and make sure that they are alright.</p>

    <p>If this command returns something as displayed below, then you most likely have a LDAPS certificate issue.</p>

    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>root@cee4a6876f55:/var/www/passbolt# ldapsearch <span class="nt">-x</span> <span class="nt">-D</span> <span class="s2">"ada"</span> <span class="nt">-W</span> <span class="nt">-H</span> ldaps://your_ldap_server.com <span class="nt">-b</span> <span class="s2">"dc=passbolt,dc=local"</span> <span class="nt">-d</span> 9
ldap_url_parse_ext<span class="o">(</span>ldaps://your_ldap_server.com<span class="o">)</span>
ldap_create
ldap_url_parse_ext<span class="o">(</span>ldaps://your_ldap_server.com:636/??base<span class="o">)</span>
Enter LDAP Password:
ldap_sasl_bind
ldap_send_initial_request
ldap_new_connection 1 1 0
ldap_int_open_connection
ldap_connect_to_host: TCP your_ldap_server.com:636
ldap_new_socket: 3
ldap_prepare_socket: 3
ldap_connect_to_host: Trying 34.77.243.127:636
ldap_pvt_connect: fd: 3 tm: <span class="nt">-1</span> async: 0
attempting to connect:
connect success
ldap_err2string
ldap_sasl_bind<span class="o">(</span>SIMPLE<span class="o">)</span>: Can<span class="s1">'t contact LDAP server (-1)
</span></code></pre></div>    </div>

    <p>If that‚Äôs the case, the good news is that it‚Äôs quite easy to fix. The issue is that the client is not trusting the certificate provided by the server.
Let‚Äôs fix this by moving forward to the next step.</p>

    <h3 id="step-3-download-a-correctly-chained-ssl-certificate">Step 3: Download a correctly chained SSL certificate</h3>

    <p>Openldap requires usually the entire chained certificate. We have developed a quick utility that aims to help retrieve all the parts of a ldaps certificate and bundle them together.
You can access this tool <a href="https://github.com/passbolt/ldaps_cert_util">here</a></p>

    <p>Follow the README instructions, retrieve your certificate and move to step 2.</p>

    <h3 id="step-4-tell-openldap-to-use-the-right-certificate">Step 4: tell openldap to use the right certificate</h3>

    <p>In Debian:</p>

    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>nano /etc/ldap/ldap.conf
</code></pre></div>    </div>

    <p><em>Note that the ldap.conf can also be found in /etc/ldap/ldap.conf, depending on your distro</em></p>

    <p>The content of the file should look like:</p>

    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>#
# LDAP Defaults
#

# See ldap.conf(5) for details
# This file should be world readable but not world writable.

#BASE   dc=example,dc=com
#URI    ldap://ldap.example.com ldap://ldap-master.example.com:666

#SIZELIMIT      12
#TIMELIMIT      15
#DEREF          never

# TLS certificates (needed for GnuTLS)
TLS_CACERT      /etc/ssl/certs/cert.crt
</code></pre></div>    </div>

    <p>Edit the line with <code class="language-plaintext highlighter-rouge">TLS_CACERT</code> to make it point to the right certificate.</p>

    <p>That‚Äôs it. It should now work. Go back to step 1 and execute the ldapsearch command again. You should see a
successful connection to your ldaps server happening. If that‚Äôs the case, you can get back to Passbolt and try the synchronization again.</p>

    <h3 id="alternatively">Alternatively</h3>

    <p>If for some obscure reasons openldap was still refusing to cooperate, you can try telling him to ignore the certificate.</p>

    <div class="message warning">
    <p>
        <strong>Warning:</strong> Do this for tests purpose only. This practice is insecure and could make your server prone to MITM attacks.
    </p>
    
</div>

    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>nano /etc/ldap/ldap.conf
</code></pre></div>    </div>

    <p>Then add the line: <code class="language-plaintext highlighter-rouge">TLS_REQCERT never</code>, and try again.</p>

    <p>If now the connection is going through, it means that there is still an issue with your certificate.</p>

    <div class="last-updated">
      <h3>Last updated</h3>
      <p>This article was last updated on 
February
7th,
2020.</p>
    </div>

  </div>
  <div class="col4 last push1">

    <div class="message tldr notice">
    <p>Are you experiencing issues with Passbolt Pro Edition?</p>
    <a href="mailto:contact@passbolt.com" class="button primary">Contact Pro support</a>
    <p>or <a href="https://community.passbolt.com">ask the community</a></p>

</div>

  </div>
</div>

                    </article>
                </div>
            </div>
        </div>
            <footer>
        <div class="footer">
            <ul class="footer-links">
                <li><a href="https://www.passbolt.com/licence">Terms</a></li>
                <li><a href="https://www.passbolt.com/privacy">Privacy</a></li>
                <li><a href="https://www.passbolt.com/credits">Credits</a></li>
                <li><a href="https://careers.passbolt.com">Careers</a></li>
            </ul>
        </div>
    </footer>
    <div id="cookies-eu-banner" class="visually-hidden">
        üç™ &nbsp; Do you accept cookies for statistical purposes?
        <a href="https://www.passbolt.com/privacy" id="cookies-eu-more">(Read more)</a>
        <a class="button primary" id="cookies-eu-accept">Accept</a>
        <a id="cookies-eu-reject">No thanks!</a>
    </div>


    </div>
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-23506466-3"></script>
<script src="https://code.jquery.com/jquery-3.5.0.slim.min.js" integrity="sha384-/IFzzQmt1S744I+IQO4Mc1uphkxbXt1tEwjQ/qSw2p8pXWck09sLvqHmKDYYwReJ" crossorigin="anonymous"></script>
<script src="https://help.passbolt.com/assets/js/cookies-eu-banner.js"></script>
<script src="https://help.passbolt.com/assets/js/analytics.js"></script>
<script src="https://help.passbolt.com/assets/js/greedynav.js"></script>
</body>

</html>