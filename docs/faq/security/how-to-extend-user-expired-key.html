<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>Passbolt Help | How to extend a user expired key</title>
    <!--
             ____                  __          ____
            / __ \____  _____ ____/ /_  ____  / / /_
           / /_/ / __ `/ ___/ ___/ __ \/ __ \/ / __/
          / ____/ /_/ (__  |__  ) /_/ / /_/ / / /_
         /_/    \__,_/____/____/_.___/\____/_/\__/

         Open source password manager for teams
         © 2019 Passbolt SA

     -->
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="While setting up an account on passbolt, you can let the wizard generate OpenPGP keys for you or upload ones generated on your computer.">
    <meta property="og:image" content="https://help.passbolt.com/assets/img/background/og_preview.jpg" />
    <meta property="og:title" content="How to extend a user expired key" />
    <meta property="og:description" content="While setting up an account on passbolt, you can let the wizard generate OpenPGP keys for you or upload ones generated on your computer." />
    <link rel="stylesheet" href="https://help.passbolt.com/assets/css/help.min.css">
    <link rel="stylesheet" href="https://help.passbolt.com/assets/css/highlight.css">
    <link rel="stylesheet" href="https://help.passbolt.com/assets/css/cookie-eu-banner.css">
    <link rel="stylesheet" href="https://help.passbolt.com/assets/css/custom.css">
    <link rel="canonical" href="https://help.passbolt.com/faq/security/how-to-extend-user-expired-key">
    <link rel="shortcut icon" type="image/x-icon" href="https://help.passbolt.com/assets/favicon.ico" />
    <link rel="alternate" type="application/rss+xml" title="Passbolt | Help" href="https://help.passbolt.com/feed.xml">
</head>

<body>
<div id="container" class="help page background">
    <header>
        <div class="header first ">
            <nav class="greedy">
                <div class="top navigation primary">
                    <ul class="links clearfix">
                        <li class="home with-text"><a href="http://www.passbolt.com/"><span>home</span></a></li>
                        <li class="left"><a href="https://www.passbolt.com/services"><span>pricing</span></a></li>
                        <li class="left"><a href="https://www.passbolt.com/roadmap"><span>roadmap</span></a></li>
                        <li class="left"><a href="https://community.passbolt.com/"><span>forum</span></a></li>
                        <li class="left"><a href="https://www.passbolt.com/blog"><span>blog</span></a></li>
                        <li class="left selected"><a href="https://help.passbolt.com/"><span>help</span></a></li>
                        <li class="left"><a href="https://demo.passbolt.com" class="highlighted" target="_blank" rel="noopener"><span>try it!</span></a></li>
                    </ul>
                    <button class="hidden" count="0">more</button>
                    <ul class="hidden-links hidden"></ul>
                </div>
            </nav>
        </div>
    </header>
    <div class="header second">
        <div class="col1">
            <div class="logo no-img">
                <h1><span>Passbolt</span></h1>
            </div>
        </div>
        <div class="col2 search-wrapper">
            <h2 class="visuallyhidden">Help Search</h2>
            <div>
                <form class="search ready" action="/search.html" method="get">
                    <div class="input required">
                        <label for="search-box">Search</label>
                        <input id="search-box" name="query" maxlength="64" placeholder="Help search" class="fuzzy-search" type="search">
                    </div>
                    <button value="search">
                        <i class="fa fa-fw fa-search"></i>
                        <span class="text visuallyhidden">search</span>
                    </button>
                </form>
            </div>
        </div>
        <div class="col3">
            <div class="edit-on-github">
                <a href="https://github.com/passbolt/passbolt_help/edit/master/_faq/security/004-how-to-extend-user-expired-key.md" class="button">
                    <i class="fa fa-github-alt fa-fw"></i> Edit on github</a>
            </div>
        </div>
    </div>


    <div class="panel main" aria-label="Content">
        <div class="panel left">
            <div class="navigation-help" role="navigation">
    <ul>
        <li><h2>All FAQs</h2></li>
        

        
        <li>
        
            <a href="https://help.passbolt.com/faq/discover">Discover</a>
        </li>
        

        
        <li>
        
            <a href="https://help.passbolt.com/faq/start">Get started</a>
        </li>
        

        
        <li>
        
            <a href="https://help.passbolt.com/faq/hosting">Hosting</a>
        </li>
        

        
        <li>
        
            <a href="https://help.passbolt.com/faq/contribute">Contribute</a>
        </li>
        

        
        <li class="selected">
        
            <a href="https://help.passbolt.com/faq/security">Security</a>
        </li>
        

        
        <li>
        
            <a href="https://help.passbolt.com/faq/legal">Legal</a>
        </li>
        
    </ul>
</div>

        </div>
        <div class="panel middle" data-spy="scroll" data-target=".scrollspy">
            <div class="grid grid-responsive-12">
                <article>
                    <div class="row" id="introduction">
    <div class="col12">
        <div class="breadcrumbs">
            <ul>
                <li>
                    <div class="main-cell">
                        <a href="https://www.passbolt.com"><span>home</span></a>
                    </div>
                </li>
                <li>
                    <div class="main-cell">
                        <a href="https://help.passbolt.com"><span>help</span></a>
                    </div>
                </li>
                <li>
                    <div class="main-cell">
                        <a href="https://help.passbolt.com/faq"><span>FAQ</span></a>
                    </div>
                </li>
                <li>
                    <div class="main-cell">
                        <a href=""><span>How to extend a user expired key</span></a>
                    </div>
                </li>
            </ul>
        </div>
    </div>
</div>


                    <div class="row" markdown="1">
                        <div class="col7" markdown="1">
                         <h1>How to extend a user expired key</h1>
                            <p>While setting up an account on passbolt, you can let the wizard generate OpenPGP keys for you or upload ones generated on your computer.</p>

<p>Passbolt wizard OpenPGP keys has no expiration date. In case you generated OpenPGP keys with an expiry date, you won’t be able to authenticate to passbolt once the expiry date passed.</p>

<p>We will explain in this FAQ page how to extend your passbolt OpenPGP key if you are in this case.</p>

<h2 id="remove-expiration-date-of-your-passbolt-private-openpgp-key">Remove expiration date of your passbolt private OpenPGP key</h2>

<p>Import your private expired key:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>gpg --import private.asc
</code></pre></div></div>

<p>As you can see, this key has an expiration date:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>pub   ed25519 2022-01-21 [SC] [expires: 2024-01-21]
      B35F66C2B587EC54DB71A547C9FDEB2DC5EB9F9C
uid                      John Doe &lt;johndoe@domain.tld&gt;
sub   cv25519 2022-01-21 [E] [expires: 2024-01-21]
</code></pre></div></div>

<p>Edit the key by selecting its fingerprint</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>gpg --edit-key B35F66C2B587EC54DB71A547C9FDEB2DC5EB9F9C
</code></pre></div></div>

<p>You will get the below output:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>gpg (GnuPG) 2.3.4; Copyright (C) 2021 Free Software Foundation, Inc.
This is free software: you are free to change and redistribute it.
There is NO WARRANTY, to the extent permitted by law.

Secret key is available.

sec  ed25519/C9FDEB2DC5EB9F9C
     created: 2022-01-21  expires: 2024-01-21  usage: SC
     trust: ultimate      validity: ultimate
ssb  cv25519/54A4FF74028F12AF
     created: 2022-01-21  expires: 2024-01-21  usage: E
[ultimate] (1). John Doe &lt;johndoe@domain.tld&gt;
</code></pre></div></div>

<p>Where:</p>

<ul>
  <li>sec is the SECret key</li>
  <li>ssb is the Secret SuBkey</li>
</ul>

<p>Disable the expiration date for the secret key with the <strong>expire</strong> command:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>gpg&gt; expire
Changing expiration time for the primary key.
Please specify how long the key should be valid.
         0 = key does not expire
      &lt;n&gt;  = key expires in n days
      &lt;n&gt;w = key expires in n weeks
      &lt;n&gt;m = key expires in n months
      &lt;n&gt;y = key expires in n years
Key is valid for? (0) 0
Key does not expire at all
Is this correct? (y/N) y

sec  ed25519/C9FDEB2DC5EB9F9C
     created: 2022-01-21  expires: never       usage: SC
     trust: ultimate      validity: ultimate
ssb  cv25519/54A4FF74028F12AF
     created: 2022-01-21  expires: 2024-01-21  usage: E
[ultimate] (1). John Doe &lt;johndoe@domain.tld&gt;
</code></pre></div></div>

<p>As you can see, the expires is now <strong>never</strong> for secret key but remains 2024-01-21 for the secret subkey.</p>

<p>Select the subkey with the <strong>key 1</strong> command (you will see an asterisk next to it):</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>gpg&gt; key 1

sec  ed25519/C9FDEB2DC5EB9F9C
     created: 2022-01-21  expires: never       usage: SC
     trust: ultimate      validity: ultimate
ssb* cv25519/54A4FF74028F12AF
     created: 2022-01-21  expires: 2024-01-21  usage: E
[ultimate] (1). John Doe &lt;johndoe@domain.tld&gt;
</code></pre></div></div>

<p>Execute again the <strong>expire</strong> command:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>gpg&gt; expire
Changing expiration time for a subkey.
Please specify how long the key should be valid.
         0 = key does not expire
      &lt;n&gt;  = key expires in n days
      &lt;n&gt;w = key expires in n weeks
      &lt;n&gt;m = key expires in n months
      &lt;n&gt;y = key expires in n years
Key is valid for? (0) 0
Key does not expire at all
Is this correct? (y/N) y

sec  ed25519/C9FDEB2DC5EB9F9C
     created: 2022-01-21  expires: never       usage: SC
     trust: ultimate      validity: ultimate
ssb* cv25519/54A4FF74028F12AF
     created: 2022-01-21  expires: never       usage: E
[ultimate] (1). John Doe &lt;johndoe@domain.tld&gt;
</code></pre></div></div>

<p>Once done, execute the <strong>save</strong> command to save your changes:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>gpg&gt; save
</code></pre></div></div>

<p>Export your new extended key and save it in a safe place:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>gpg --armor --export B35F66C2B587EC54DB71A547C9FDEB2DC5EB9F9C &gt; public.asc
gpg --armor --export-secret-keys B35F66C2B587EC54DB71A547C9FDEB2DC5EB9F9C &gt; private.asc
</code></pre></div></div>

<h2 id="update-the-key-in-passbolt">Update the key in passbolt</h2>

<p>Passbolt server side, you need to update public key in <strong>gpgkeys</strong> table of passbolt database and delete it from the passbolt keyring.</p>

<h3 id="database-update">Database update</h3>

<p>First identify your user ID. Replace johndoe@domain.tld with email of your user:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>SELECT id, username FROM users WHERE username = johndoe@domain.tld;
</code></pre></div></div>

<p>The returned ID should be something like <strong>02aa768a-df59-4247-ab52-328373880016</strong></p>

<p>Confirm now you have one unique row for the below request (replace 02aa768a-df59-4247-ab52-328373880016 with ID of your user, \G is to display results vertically)</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>SELECT * FROM gpgkeys WHERE user_id = '02aa768a-df59-4247-ab52-328373880016' \G
</code></pre></div></div>

<p>If you got exactly one row, you can replace the current public OpenPGP key with the new one (replace user_id with your user’s ID and put your new OpenPGP public key as armored_key):</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>UPDATE gpgkeys SET armored_key = "-----BEGIN PGP PUBLIC KEY BLOCK-----

mQGNBGHSrQEBDADES5YK8aSSg7sIWF/GvilOYBhjYzpz1Q+mbtxZI1oZHwT0z4H5
a/tDu821EdSkrmrK1j+VUqlZr4n0wjf5NMKITvU6UioBP6QeYgtriCKZ5DOk1VOi
(....)
-----END PGP PUBLIC KEY BLOCK-----", modified = now(), expires = now() WHERE user_id = "02aa768a-df59-4247-ab52-328373880016";
</code></pre></div></div>

<p>Update the <strong>expires</strong> value of the old key with NULL (replace 02aa768a-df59-4247-ab52-328373880016 with ID of your user):</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>UPDATE gpgkeys SET expires = NULL WHERE user_id = "02aa768a-df59-4247-ab52-328373880016";
</code></pre></div></div>

<p>You can quit MySQL console.</p>

<h3 id="passbolt-gpg-keyring-update">Passbolt GPG keyring update</h3>

<p>Check path of your GPG keyring from the healthcheck page of passbolt: https://url-of-your-passbolt/healthcheck, you should see <strong>/var/lib/passbolt/.gnupg/</strong> but it can be different depending on your setup:</p>

<figure>
    <img src="https://help.passbolt.com/assets/img/help/2022/01/healthcheck.png" alt="passbolt healthcheck" style="max-width:586px;" />
    <span class="legend">fig. passbolt healthcheck</span>
</figure>

<p>You have now to remove the old OpenPGP public key from passbolt keyring. Connect as <strong>www-data</strong> user if you are using Debian or Ubuntu, or <strong>nginx</strong> if you are using CentOS:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>sudo su -s /bin/bash www-data
</code></pre></div></div>

<p>List keys and find the one you want to delete (replace <strong>/var/lib/passbolt/.gnupg</strong> with your own).</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>gpg --homedir /var/lib/passbolt/.gnupg --list-keys
</code></pre></div></div>

<p>Once ID of the key found, delete it (replace <strong>/var/lib/passbolt/.gnupg</strong> with your own and <strong>444F0E2FDD421119F69368E23F1C70EE1C10B10F</strong> with the ID of the key you want to delete):</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>gpg --homedir /var/lib/passbolt/.gnupg --delete-key 444F0E2FDD421119F69368E23F1C70EE1C10B10F
</code></pre></div></div>

<h2 id="recover-your-account">Recover your account</h2>

<p><strong>Step 1.</strong> In order to recover you will need to go to your domain URL and add <code class="language-plaintext highlighter-rouge">/recover</code> at the end of the url,
for example <code class="language-plaintext highlighter-rouge">https://yourpassbolt.com/recover</code>.</p>

<p><strong>Step 2.</strong> Complete the form by providing your email address.</p>

<p><strong>Step 3.</strong> Follow the link in your mailbox.</p>

<p><strong>Step 4.</strong> Follow the recovery steps, which is much like the initial setup. You will need to import your private key.</p>

<p><strong>Step 5.</strong> Enter your passphrase to login!</p>

                        </div>

                    <div class="col4 last push1" markdown="1">
                        
                            <div class="message tldr notice">
    <p>Not finding what you are looking for? You can also ask the community on the forum.</p>
    
    <a href="https://community.passbolt.com" class="button ">Talk to a human</a>
    
</div>

                        
                    </div>
                    </div>

                    
                    <div class="row" markdown="1">
                        <div class="col7" markdown="1">
                            <h3>Other frequently asked questions in the same category</h3>
                            <ul>
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    <li>
        <a href="/faq/security/security-vulnerability">How can I report a security vulnerability?</a>
    </li>
    
    
    
    
    
    <li>
        <a href="/faq/security/what-is-encrypted">What data is encrypted in passbolt?</a>
    </li>
    
    
    
    
    
    <li>
        <a href="/faq/security/encryption-tech">What kind of encryption does passbolt use?</a>
    </li>
    
    
    
    
    
    <li>
        <a href="/faq/security/authentication">How does authentication work in passbolt?</a>
    </li>
    
    
    
    
    
    <li>
        <a href="/faq/security/javascript-security">Is javascript cryptographically secure?</a>
    </li>
    
    
    
    
    
    <li>
        <a href="/faq/security/is-open-source-secure">Is open source software less secure?</a>
    </li>
    
    
    
    
    
    <li>
        <a href="/faq/security/revocation-certificate">Does passbolt support revocation certificates?</a>
    </li>
    
    
    
    
    
    <li>
        <a href="/faq/security/public-key-trust">How are public keys trusted?</a>
    </li>
    
    
    
    
    
    <li>
        <a href="/faq/security/security-token">What is the security token?</a>
    </li>
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    <li>
        <a href="/faq/security/change-passphrase">How can I change my passphrase?</a>
    </li>
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    <li>
        <a href="/faq/security/compromised-secret-key">My secret key and passphrase are compromised, what do I do?</a>
    </li>
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    <li>
        <a href="/faq/security/how-to-extend-user-expired-key">How to extend a user expired key</a>
    </li>
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    <li>
        <a href="/faq/security/is-passbolt-secure">Is it secure to use passbolt?</a>
    </li>
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    <li>
        <a href="/faq/security/code-review">Has the code been reviewed?</a>
    </li>
    
    
    
    
    
    
    
    
    
</ul>

                        </div>

                    <div class="col4 last push1" markdown="1">
                    </div>

                    </div>

                    </div>
                    

                </article>
            </div>
        </div>
    </div>

    <footer>
        <div class="footer">
            <ul class="footer-links">
                <li><a href="https://www.passbolt.com/licence">Terms</a></li>
                <li><a href="https://www.passbolt.com/privacy">Privacy</a></li>
                <li><a href="https://www.passbolt.com/credits">Credits</a></li>
                <li><a href="https://careers.passbolt.com">Careers</a></li>
            </ul>
        </div>
    </footer>
    <div id="cookies-eu-banner" class="visually-hidden">
        🍪 &nbsp; Do you accept cookies for statistical purposes?
        <a href="https://www.passbolt.com/privacy" id="cookies-eu-more">(Read more)</a>
        <a class="button primary" id="cookies-eu-accept">Accept</a>
        <a id="cookies-eu-reject">No thanks!</a>
    </div>


</div>
<script src="https://consent.cookiebot.com/uc.js" data-cbid="900808a8-f178-4994-b2ad-66bf3ccca5f7" data-blockingmode="auto" strategy="beforeInteractive"></script>
<script src="https://help.passbolt.com/assets/js/matomo-tag-manager.js"></script>
<script src="https://help.passbolt.com/assets/js/matomo-analytics.js"></script>
<script src="https://code.jquery.com/jquery-3.5.0.slim.min.js" integrity="sha384-/IFzzQmt1S744I+IQO4Mc1uphkxbXt1tEwjQ/qSw2p8pXWck09sLvqHmKDYYwReJ" crossorigin="anonymous"></script>
<script src="https://help.passbolt.com/assets/js/analytics.js"></script>
<script src="https://help.passbolt.com/assets/js/greedynav.js"></script>
</body>
</html>
