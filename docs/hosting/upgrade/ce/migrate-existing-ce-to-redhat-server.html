<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>Passbolt Help | Migrate an existing Passbolt CE to a new Red Hat server</title>
    <!--
             ____                  __          ____
            / __ \____  _____ ____/ /_  ____  / / /_
           / /_/ / __ `/ ___/ ___/ __ \/ __ \/ / __/
          / ____/ /_/ (__  |__  ) /_/ / /_/ / / /_
         /_/    \__,_/____/____/_.___/\____/_/\__/

         Open source password manager for teams
         ¬© 2019 Passbolt SA

     -->
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="">
    <meta property="og:image" content="https://help.passbolt.com/assets/img/background/og_preview.jpg" />
    <meta property="og:title" content="Migrate an existing Passbolt CE to a new Red Hat server" />
    <meta property="og:description" content="" />
    <link rel="stylesheet" href="https://help.passbolt.com/assets/css/help.min.css">
    <link rel="stylesheet" href="https://help.passbolt.com/assets/css/highlight.css">
    <link rel="stylesheet" href="https://help.passbolt.com/assets/css/cookie-eu-banner.css">
    <link rel="stylesheet" href="https://help.passbolt.com/assets/css/custom.css">
    <link rel="canonical" href="https://help.passbolt.com/hosting/upgrade/ce/migrate-existing-ce-to-redhat-server">
    <link rel="shortcut icon" type="image/x-icon" href="https://help.passbolt.com/assets/favicon.ico" />
    <link rel="alternate" type="application/rss+xml" title="Passbolt | Help" href="https://help.passbolt.com/feed.xml">
</head>


<body>
    <div id="container" class="help page background">
            <header>
        <div class="header first ">
            <nav class="greedy">
                <div class="top navigation primary">
                    <ul class="links clearfix">
                        <li class="home with-text"><a href="http://www.passbolt.com/"><span>home</span></a></li>
                        <li class="left"><a href="https://www.passbolt.com/services"><span>pricing</span></a></li>
                        <li class="left"><a href="https://www.passbolt.com/roadmap"><span>roadmap</span></a></li>
                        <li class="left"><a href="https://community.passbolt.com/"><span>forum</span></a></li>
                        <li class="left"><a href="https://www.passbolt.com/blog"><span>blog</span></a></li>
                        <li class="left selected"><a href="https://help.passbolt.com/"><span>help</span></a></li>
                        <li class="left"><a href="https://demo.passbolt.com" class="highlighted" target="_blank" rel="noopener"><span>try it!</span></a></li>
                    </ul>
                    <button class="hidden" count="0">more</button>
                    <ul class="hidden-links hidden"></ul>
                </div>
            </nav>
        </div>
    </header>
    <div class="header second">
        <div class="col1">
            <div class="logo no-img">
                <h1><span>Passbolt</span></h1>
            </div>
        </div>
        <div class="col2 search-wrapper">
            <h2 class="visuallyhidden">Help Search</h2>
            <div>
                <form class="search ready" action="/search.html" method="get">
                    <div class="input required">
                        <label for="search-box">Search</label>
                        <input id="search-box" name="query" maxlength="64" placeholder="Help search" class="fuzzy-search" type="search">
                    </div>
                    <button value="search">
                        <i class="fa fa-fw fa-search"></i>
                        <span class="text visuallyhidden">search</span>
                    </button>
                </form>
            </div>
        </div>
        <div class="col3">
            <div class="edit-on-github">
                <a href="https://github.com/passbolt/passbolt_help/edit/master/_posts/hosting/upgrade/2021-11-26-migrate-existing-ce-to-redhat-server.md" class="button">
                    <i class="fa fa-github-alt fa-fw"></i> Edit on github</a>
            </div>
        </div>
    </div>

        <div class="panel main" aria-label="Content">
            <div class="panel left">
                
                







<div class="navigation-help" role="navigation">
    <ul>
        <li>
            <h2>Hosting</h2>
        </li>
        
        <li >
            <a href="https://help.passbolt.com/faq/hosting">Hosting FAQ</a>
        </li>
        
        
        <li >
            <a href="https://help.passbolt.com/hosting/install">Installation</a>
        </li>
        
        
        <li >
            <a href="https://help.passbolt.com/hosting/update">Update</a>
        </li>
        
        
        <li >
            <a href="https://help.passbolt.com/hosting/upgrade">Upgrade</a>
        </li>
        
        
        
        
        <li >
            <a href="https://help.passbolt.com/hosting/backup">Backup</a>
        </li>
        
        
        <li >
            <a href="https://community.passbolt.com/c/installation-issues">Installation issues</a>
        </li>
        
        
    </ul>
</div>










                
            </div>
            <div class="panel middle" data-spy="scroll" data-target=".scrollspy">
                <div class="grid grid-responsive-12">
                    <article>
                        <div class="row" id="introduction">
    <div class="col12">
        <div class="breadcrumbs">
            <ul>
                <li>
                    <div class="main-cell">
                        <a href="https://www.passbolt.com"><span>home</span></a>
                    </div>
                </li>
                <li>
                    <div class="main-cell">
                        <a href="/"><span>help</span></a>
                    </div>
                </li>
                
                
                <li>
                    <div class="main-cell">
                        <a href="https://help.passbolt.com/hosting"><span>hosting</span></a>
                    </div>
                </li>
                <li>
                    <div class="main-cell">
                        <a href="https://help.passbolt.com/hosting/upgrade"><span>upgrade</span></a>
                    </div>
                </li>
                
                
                
                <li>
                    <div class="main-cell">
                        <a href="https://help.passbolt.com/hosting/upgrade/ce/migrate-existing-ce-to-redhat-server.html"><span>migrate-existing-ce-to-redhat-server</span></a>
                    </div>
                </li>
                
            </ul>
        </div>
    </div>
</div>

                        <div class="row" markdown="1">
<div class="col7" markdown="1">
<h1>Migrate an existing Passbolt CE to a new Red Hat server</h1>
</div>
</div>

                        
<div class="row">
  <div class="col7">

    <p>This document describes how to migrate an existing passbolt to a new Red Hat server.</p>

    <h2 id="pre-requisites">Pre-requisites</h2>

    <p>For this tutorial, you will need:</p>
    <ul>
      <li>Passbolt installed on an old server</li>
      <li>A minimal Red Hat 8 new server</li>
    </ul>

    <h2 id="backup-the-existing-data">Backup the existing data</h2>

    <p>Prior to the migration you will need to backup the existing passbolt instance data. Please refer to <a href="/hosting/backup">the official backup documentations</a>.</p>

    <p>Depending on your SSL configuration you might need to copy the certificate and key from the existing instance. If you are using let‚Äôs encrypt you can continue you‚Äôll configure it later directly in the new server.</p>

    <p>Don‚Äôt delete the existing instance yet!</p>

    <h2 id="prepare-the-new-red-hat-server">Prepare the new Red Hat server</h2>

    <h2 id="package-repository-setup">Package repository setup</h2>

    <p>For easier installation and update tasks Passbolt provides a package repository that you need to setup
before you download Passbolt CE and install it.</p>

    <p><strong>Step 1.</strong> Download our dependencies installation script:</p>

    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>wget https://raw.githubusercontent.com/passbolt/passbolt-dep-scripts/main/passbolt-repo-setup.ce.sh
</code></pre></div>    </div>

    <p><strong>Step 2.</strong> Ensure that the script is valid and execute it:</p>

    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[ "$(sha256sum passbolt-repo-setup.ce.sh | awk '{print $1}')" = "aefee8175e3dc2a992e0b614c3dd81ca1d666e59e0a9909967c52b88e348da59" ] &amp;&amp; sudo bash ./passbolt-repo-setup.ce.sh || echo "Bad checksum. Aborting" &amp;&amp; rm -f passbolt-repo-setup.ce.sh
</code></pre></div>    </div>

    <h2 id="install-passbolt-official-linux-package">Install passbolt official linux package</h2>

    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>sudo dnf install passbolt-ce-server
</code></pre></div>    </div>

    <p>During the installation, you will be asked to accept the Passbolt repository GPG key. You must ensure the fingerprint is exactly the same as the one below:</p>

    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Importing GPG key 0xC155581D:
 Userid     : "Passbolt SA package signing key &lt;contact@passbolt.com&gt;"
 Fingerprint: 3D1A 0346 C8E1 802F 774A EF21 DE8B 853F C155 581D
 From       : https://download.passbolt.com/pub.key
</code></pre></div>    </div>

    <h4 id="mariadb--nginx--ssl-settings">MariaDB / Nginx / SSL settings</h4>

    <p>Passbolt CE RPM package on Red Hat 8 come with a configuration helper tool to prepare MariaDB, Nginx and SSL settings.</p>

    <p>You must prepare beforehand your SSL certificates before launching the tool. Be sure to write down the full path to your cert/key combo, as it will be needed in the nginx configuration process.</p>

    <p>Please, notice that for security matters we highly recommend to setup SSL to serve passbolt.</p>

    <p>Launch <code class="language-plaintext highlighter-rouge">passbolt-configure</code> tool and answer to the questions:</p>

    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>sudo /usr/local/bin/passbolt-configure
</code></pre></div>    </div>

    <h4 id="mariadb">MariaDB</h4>

    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>================================================================
Do you want to configure a local mariadb server on this machine?
================================================================
1) yes
2) no
#?
</code></pre></div>    </div>

    <p>Answer <strong>1</strong> for yes if you want to configure a local MariaDB database, otherwise <strong>2</strong> for no if you plan to use an existing one.</p>

    <p>If you chose yes, answer the questions:</p>

    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>=======================================================
Please enter a new password for the root database user:
=======================================================
MariaDB Root Password: ****
MariaDB Root Password (verify): ****
======================================================
Please enter a name for the passbolt database username
======================================================
Passbolt database user name:passboltuser
=======================================================
Please enter a new password for the mysql passbolt user
=======================================================
MariaDB passbolt user password: ****
MariaDB passbolt user password (verify): ****
==============================================
Please enter a name for the passbolt database:
==============================================
Passbolt database name:passboltdb
</code></pre></div>    </div>

    <h4 id="haveged">Haveged</h4>

    <p>On virtualized environments GnuPG happen to find not enough entropy to generate a key. Therefore, Passbolt will not run properly.</p>

    <p>You should consider to install Haveged to speed up the entropy generation. Please check <a href="https://help.passbolt.com/faq/hosting/why-haveged-virtual-env">our FAQ page about this</a> for more informations.</p>

    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>==================
Install Haveged ?
==================
1) yes
2) no
#?
</code></pre></div>    </div>

    <h4 id="nginx">Nginx</h4>

    <p>Please enter the domain name under which passbolt will run.</p>

    <p>Note this hostname will be used as server_name for nginx and as the domain name to register a SSL certificate with let‚Äôs encrypt if you don‚Äôt have your own SSL certificates.</p>

    <p>If you don‚Äôt have a domain name and you do not plan to use let‚Äôs encrypt please enter the ip address to access this machine.</p>

    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>=========
Hostname: passbolt.domain.tld
=========
</code></pre></div>    </div>

    <h4 id="ssl-configuration">SSL configuration</h4>

    <p>3 available choices for SSL configuration:</p>

    <ul>
      <li>manual: Prompts for the path of user uploaded ssl certificates and set up nginx</li>
      <li>auto:   Will issue a free SSL certificate with https://www.letsencrypt.org and set up nginx</li>
      <li>none:   Do not setup HTTPS at all</li>
    </ul>

    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>==================
Setting up SSL...
==================
1) manual
2) auto
3) none
#?
</code></pre></div>    </div>

    <p>If you choose <strong>1</strong>, you will be prompted for the full path of your certificates:</p>

    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Enter the path to the SSL certificate: /path/to/certs/cert.pem
Enter the path to the SSL privkey: /path/to/certs/key.pem
</code></pre></div>    </div>

    <p>Nginx and MariaDB are now on the way to be configured. You will be notified at the end of the process to connect to the Passbolt web interface to finish the configuration.</p>

    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>===============================================================
Installation is almost complete. Please point your browser to
  https://passbolt.domain.tld to complete the process
===============================================================
</code></pre></div>    </div>

    <h2 id="migrate-data">Migrate data</h2>

    <p>Load the backup files into the new Red Hat server, for the following tasks we will consider that the backup files are in your user home directory <code class="language-plaintext highlighter-rouge">~/backup</code></p>

    <p>You should have:</p>

    <ul>
      <li>the private and public GPG key</li>
      <li>Your database dump</li>
      <li>The avatar archive file <code class="language-plaintext highlighter-rouge">passbolt-avatars.tar.gz</code> if you are coming from Passbolt prior to 3.2</li>
    </ul>

    <p><strong>Step 1.</strong> Restore Passbolt configuration file and ensure rights and ownership are correct:</p>

    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>sudo mv ~/backup/passbolt.php /etc/passbolt
sudo chown nginx:nginx /etc/passbolt/passbolt.php
sudo chmod 440 /etc/passbolt/passbolt.php
</code></pre></div>    </div>

    <p><strong>Step 2.</strong> Restore GPG public and private keys and ensure rights and ownership are correct:</p>

    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>sudo mv ~/backup/serverkey.asc /etc/passbolt/gpg
sudo mv ~/backup/serverkey_private.asc /etc/passbolt/gpg
sudo chown nginx:nginx /etc/passbolt/gpg/serverkey_private.asc
sudo chown nginx:nginx /etc/passbolt/gpg/serverkey.asc
sudo chmod 440 /etc/passbolt/gpg/serverkey.asc
sudo chmod 440 /etc/passbolt/gpg/serverkey_private.asc
</code></pre></div>    </div>

    <p><strong>Step 3.</strong> Extract the passbolt-avatars.tar.gz archive and set correct rights (if coming from Passbolt version prior to 3.2)</p>

    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>sudo tar xzf passbolt-avatars.tar.gz -C /usr/share/php/passbolt/
sudo chown -R nginx:nginx /usr/share/php/passbolt/webroot/img/public
</code></pre></div>    </div>

    <p><strong>Step 4.</strong> Load the database</p>

    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>mysql -u PASSBOLT_DATABASE_USER -p PASSBOLT_DATABASE &lt; passbolt-backup.sql
</code></pre></div>    </div>

    <p><strong>Step 5.</strong> Migrate passbolt to the latest version</p>

    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>sudo -H -u nginx /bin/bash -c "/usr/share/php/passbolt/bin/cake passbolt migrate"
</code></pre></div>    </div>

    <p><strong>Step 6.</strong> Test passbolt</p>

    <p>Try to access your passbolt application with your browser.</p>

    <p>If you are encountering any issues, you can run the following command to assess the status of your instance:</p>

    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>sudo -H -u nginx /bin/bash -c "/usr/share/php/passbolt/bin/cake passbolt healthcheck"
</code></pre></div>    </div>
    <div class="last-updated">
      <h3>Last updated</h3>
      <p>This article was last updated on 
November
26th,
2021.</p>
    </div>

  </div>
  <div class="col4 last push1">

    <div class="message tldr notice">
    <p>Are you experiencing issues when updating passbolt?</p>
    
    <a href="https://community.passbolt.com/c/installation-issues" class="button primary">Ask the community!</a>
    
</div>

    <div class="message ">
    <p></p>
    
</div>

    <div class="message tldr">
    <p>Something is not accurate in this documentation? You can contribute by opening an issue or making pull requests!</p>
    
    <a href="https://www.github.com/passbolt/passbolt_help" class="button ">View on github</a>
    
</div>

  </div>
</div>

                    </article>
                </div>
            </div>
        </div>
            <footer>
        <div class="footer">
            <ul class="footer-links">
                <li><a href="https://www.passbolt.com/licence">Terms</a></li>
                <li><a href="https://www.passbolt.com/privacy">Privacy</a></li>
                <li><a href="https://www.passbolt.com/credits">Credits</a></li>
                <li><a href="https://careers.passbolt.com">Careers</a></li>
            </ul>
        </div>
    </footer>
    <div id="cookies-eu-banner" class="visually-hidden">
        üç™ &nbsp; Do you accept cookies for statistical purposes?
        <a href="https://www.passbolt.com/privacy" id="cookies-eu-more">(Read more)</a>
        <a class="button primary" id="cookies-eu-accept">Accept</a>
        <a id="cookies-eu-reject">No thanks!</a>
    </div>


    </div>
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-23506466-3"></script>
<script src="https://code.jquery.com/jquery-3.5.0.slim.min.js" integrity="sha384-/IFzzQmt1S744I+IQO4Mc1uphkxbXt1tEwjQ/qSw2p8pXWck09sLvqHmKDYYwReJ" crossorigin="anonymous"></script>
<script src="https://help.passbolt.com/assets/js/cookies-eu-banner.js"></script>
<script src="https://help.passbolt.com/assets/js/analytics.js"></script>
<script src="https://help.passbolt.com/assets/js/greedynav.js"></script>
</body>

</html>