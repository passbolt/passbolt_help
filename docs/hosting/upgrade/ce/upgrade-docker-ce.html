<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>Passbolt Help | Upgrade Passbolt docker from v1</title>
    <!--
             ____                  __          ____
            / __ \____  _____ ____/ /_  ____  / / /_
           / /_/ / __ `/ ___/ ___/ __ \/ __ \/ / __/
          / ____/ /_/ (__  |__  ) /_/ / /_/ / / /_
         /_/    \__,_/____/____/_.___/\____/_/\__/

         Open source password manager for teams
         ¬© 2019 Passbolt SA

     -->
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="">
    <meta property="og:image" content="https://help.passbolt.com/assets/img/background/og_preview.jpg" />
    <meta property="og:title" content="Upgrade Passbolt docker from v1" />
    <meta property="og:description" content="" />
    <link rel="stylesheet" href="https://help.passbolt.com/assets/css/help.min.css">
    <link rel="stylesheet" href="https://help.passbolt.com/assets/css/highlight.css">
    <link rel="stylesheet" href="https://help.passbolt.com/assets/css/cookie-eu-banner.css">
    <link rel="canonical" href="https://help.passbolt.com/hosting/upgrade/ce/upgrade-docker-ce">
    <link rel="shortcut icon" type="image/x-icon" href="https://help.passbolt.com/assets/favicon.ico" />
    <link rel="alternate" type="application/rss+xml" title="Passbolt | Help" href="https://help.passbolt.com/feed.xml">

</head>


<body>
    <div id="container" class="help page background">
            <header>
        <div class="header first ">
            <nav class="greedy">
                <div class="top navigation primary">
                    <ul class="links clearfix">
                        <li class="home with-text"><a href="http://www.passbolt.com/"><span>home</span></a></li>
                        <li class="left"><a href="https://www.passbolt.com/services"><span>pricing</span></a></li>
                        <li class="left"><a href="https://www.passbolt.com/roadmap"><span>roadmap</span></a></li>
                        <li class="left"><a href="https://community.passbolt.com/"><span>forum</span></a></li>
                        <li class="left"><a href="https://www.passbolt.com/blog"><span>blog</span></a></li>
                        <li class="left selected"><a href="https://help.passbolt.com/"><span>help</span></a></li>
                        <li class="left"><a href="https://demo.passbolt.com" class="highlighted" target="_blank" rel="noopener"><span>try it!</span></a></li>
                    </ul>
                    <button class="hidden" count="0">more</button>
                    <ul class="hidden-links hidden"></ul>
                </div>
            </nav>
        </div>
    </header>
    <div class="header second">
        <div class="col1">
            <div class="logo no-img">
                <h1><span>Passbolt</span></h1>
            </div>
        </div>
        <div class="col2 search-wrapper">
            <h2 class="visuallyhidden">Help Search</h2>
            <div>
                <form class="search ready" action="/search.html" method="get">
                    <div class="input required">
                        <label for="search-box">Search</label>
                        <input id="search-box" name="query" maxlength="64" placeholder="Help search" class="fuzzy-search" type="search">
                    </div>
                    <button value="search">
                        <i class="fa fa-fw fa-search"></i>
                        <span class="text visuallyhidden">search</span>
                    </button>
                </form>
            </div>
        </div>
        <div class="col3">
            <div class="edit-on-github">
                <a href="https://github.com/passbolt/passbolt_help/edit/master/_posts/hosting/upgrade/2018-04-10-hosting-upgrade-docker-ce.md" class="button">
                    <i class="fa fa-github-alt fa-fw"></i> Edit on github</a>
            </div>
        </div>
    </div>

        <div class="panel main" aria-label="Content">
            <div class="panel left">
                
                







<div class="navigation-help" role="navigation">
    <ul>
        <li>
            <h2>Hosting</h2>
        </li>
        
        <li >
            <a href="https://help.passbolt.com/faq/hosting">Hosting FAQ</a>
        </li>
        
        
        <li >
            <a href="https://help.passbolt.com/hosting/install">Installation</a>
        </li>
        
        
        <li >
            <a href="https://help.passbolt.com/hosting/update">Update</a>
        </li>
        
        
        <li >
            <a href="https://help.passbolt.com/hosting/upgrade">Upgrade</a>
        </li>
        
        
        
        
        <li >
            <a href="https://help.passbolt.com/hosting/backup">Backup</a>
        </li>
        
        
        <li >
            <a href="https://community.passbolt.com/c/installation-issues">Installation issues</a>
        </li>
        
        
    </ul>
</div>










                
            </div>
            <div class="panel middle" data-spy="scroll" data-target=".scrollspy">
                <div class="grid grid-responsive-12">
                    <article>
                        <div class="row" id="introduction">
    <div class="col12">
        <div class="breadcrumbs">
            <ul>
                <li>
                    <div class="main-cell">
                        <a href="https://www.passbolt.com"><span>home</span></a>
                    </div>
                </li>
                <li>
                    <div class="main-cell">
                        <a href="/"><span>help</span></a>
                    </div>
                </li>
                
                
                <li>
                    <div class="main-cell">
                        <a href="https://help.passbolt.com/hosting"><span>hosting</span></a>
                    </div>
                </li>
                <li>
                    <div class="main-cell">
                        <a href="https://help.passbolt.com/hosting/upgrade"><span>upgrade</span></a>
                    </div>
                </li>
                
                
                
                <li>
                    <div class="main-cell">
                        <a href="https://help.passbolt.com/hosting/upgrade/ce/upgrade-docker-ce.html"><span>upgrade-docker-ce</span></a>
                    </div>
                </li>
                
            </ul>
        </div>
    </div>
</div>

                        <div class="row" markdown="1">
<div class="col7" markdown="1">
<h1>Upgrade Passbolt docker from v1</h1>
</div>
</div>

                        <div class="row">
  <div class="col7">

    <p>This tutorial covers the case where you want to upgrade your current docker installation of passbolt CE v1.x into passbolt CE v2.x.</p>

    <div class="message warning">
    <p>
        <strong>Important:</strong> Please take a full <a href="/hosting/backup-v1">backup</a> of your passbolt before proceeding with the upgrade. Backup should include passbolt files as well as the database.
    </p>
    
</div>

    <h2 id="upgrade-from-v1610-debian">Upgrade from v1.6.10-debian</h2>

    <p>Passbolt v2 introduces several changes that are important to keep in mind when upgrading:</p>

    <h4 id="changes-environment-variables">Changes: Environment variables</h4>

    <p>The set of environment variables have changed and users should take some time to get familiar with the new ones. For example in case of the database env variables:</p>

    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>DB_USER is now DATASOURCES_DEFAULT_USERNAME
DB_HOST is now DATASOURCES_DEFAULT_HOST
</code></pre></div>    </div>
    <p>There is a more detailed list in passbolt_docker <a href="https://github.com/passbolt/passbolt_docker/blob/master/README.md">README</a> file.</p>

    <h4 id="changes-configuration-files">Changes: Configuration files</h4>

    <p>No more core.php, email.php or database.php.
Any user that does not want to use environment variables must configure passbolt using:</p>
    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>/var/www/passbolt/config/passbolt.php
</code></pre></div>    </div>
    <p>Passbolt will look for for configuration values in <code class="language-plaintext highlighter-rouge">passbolt.php</code>. Wether <code class="language-plaintext highlighter-rouge">passbolt.php</code> does not exist or the configuration section is not defined on it, passbolt will then look for configuration details in default.php which relies on environment variables/default values.
Gpg config directory has changed slightly its path from:</p>

    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>/var/www/passbolt/app/Config/gpg/ to /var/www/passbolt/config/gpg
</code></pre></div>    </div>

    <p>Gpg default server key file names also changed:</p>

    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>serverkey.private.asc to serverkey_private.asc
</code></pre></div>    </div>

    <h4 id="changes-www-user">Changes: www user</h4>

    <p>Passbolt container is now running under the www-data user</p>

    <h4 id="changes-images-directory">Changes: images directory</h4>

    <p>Path to the images directory is different:</p>

    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>/var/www/passbolt/app/webroot/img/public/images to /var/www/passbolt/webroot/img/public/images
</code></pre></div>    </div>

    <p>Users must also rename ProfileAvatar to Avatar directory inside public/images in order to see images in passbolt v2</p>

    <h4 id="changes-supervisor">Changes: supervisor</h4>

    <p>In order to manage the running process in passbolt container we introduced supervisord. Users are now able to restart passbolt container processes using:</p>

    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>docker <span class="nb">exec </span>passbolt supervisorctl restart &lt;php-fpm|nginx|cron&gt;
</code></pre></div>    </div>

    <p>Now that we have a better overview of the changes let‚Äôs start with the upgrading process!</p>

    <h3 id="backup-mariadb-database">Backup MariaDB database</h3>

    <p>First of all is encouraged to backup all the relevant data that is:</p>
    <ul>
      <li>Database</li>
      <li>Images</li>
      <li>Server public and private keys</li>
    </ul>

    <p>You might want to check the detailed <a href="/hosting/backup-v1">backup list for v1</a></p>

    <p>There are multiple ways to backup your database following there is an example using the passbolt container:</p>
    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>docker <span class="nb">exec </span>passbolt mysqldump <span class="nt">-h</span> &lt;db_host&gt; <span class="se">\</span>
                                 <span class="nt">-u</span> passbolt <span class="se">\</span>
                                 <span class="nt">-pP4ssb0lt</span> <span class="se">\</span>
                                 passbolt <span class="o">&gt;</span> dump.sql
</code></pre></div>    </div>

    <p>This will output a dump.sql file on the host machine.</p>

    <h3 id="backup-images-directory">Backup images directory</h3>

    <p>If you are mounting the images directory using a bind mount just copy the host image directory in a safe location.
If you are using docker volumes to persist your images directory, or not persisting the images directory at all, you can execute the following to copy your images to the host machine.</p>

    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>docker <span class="nb">cp </span>passbolt:/var/www/app/webroot/img/public public_images_backup
</code></pre></div>    </div>
    <p>This will output a public_images_directory with the images stored in the passbolt container.</p>

    <h3 id="backup-gpg-keys">Backup gpg keys</h3>

    <p>As with the previous section you can proceed exactly the same with the gpg keys:</p>

    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>docker <span class="nb">cp </span>passbolt:/var/www/app/Config/gpg/ gpg_keys_backup
</code></pre></div>    </div>

    <p>This will output a gpg_keys_backup directory with the contents of the gpg configuration folder of passbolt.</p>

    <h2 id="getting-passbolt-container">Getting passbolt container</h2>

    <p>Passbolt containers follow the following tagging:</p>

    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&lt;version_number&gt;-&lt;build_number&gt;-debian
</code></pre></div>    </div>

    <p>Nobody is perfect so we also provide a  <em>latest</em> tag for Passbolt containers. Through all this documentation pages we make use of the latest tag so users will get the last version of passbolt.
However, it is recommended that users pull the tags pointing to specific passbolt versions when running in environments other than testing.</p>

    <p>Get passbolt  latest docker container:</p>
    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>docker pull passbolt/passbolt:latest
</code></pre></div>    </div>

    <h2 id="upgrade-using-latest-v1-version-1610">Upgrade using latest v1 version (1.6.10)</h2>

    <p>Passbolt  v2 will run the database migrations if needed when starting up. Users just need to provide the gpg keys, configuration files/env variables and images.
Following some examples:</p>

    <h3 id="using-host-bind-mounts">Using host bind mounts</h3>

    <p>Users that use host bind mounts from host machine into docker file must adjust paths of the mounted files:</p>

    <p>In the following snippet:</p>
    <ul>
      <li>passbolt_images_dir: path to a host directory that contains passbolt images Avatar directory.</li>
      <li>gpg_host_dir: path to a host directory that contains serverkey.asc and serverkey_private.asc</li>
    </ul>

    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>docker run <span class="nt">--name</span> passbolt <span class="nt">--net</span> passbolt_network <span class="se">\</span>
             <span class="nt">--mount</span> <span class="nb">type</span><span class="o">=</span><span class="nb">bind</span>, <span class="se">\</span>
               <span class="nb">source</span><span class="o">=</span>&lt;passbolt_images_dir&gt;,<span class="se">\</span>
               <span class="nv">target</span><span class="o">=</span>/var/www/passbolt/webroot/img <span class="se">\</span>
             <span class="nt">--mount</span> <span class="nb">type</span><span class="o">=</span><span class="nb">bind</span>, <span class="se">\</span>
               <span class="nb">source</span><span class="o">=</span>&lt;gpg_host_dir&gt;, <span class="se">\</span>
               <span class="nv">target</span><span class="o">=</span>/var/www/passbolt/config/gpg <span class="se">\</span>
             <span class="nt">-p</span> 443:443 <span class="se">\</span>
             <span class="nt">-p</span> 80:80 <span class="se">\</span>
             <span class="nt">-e</span> <span class="nv">DATASOURCES_DEFAULT_HOST</span><span class="o">=</span>mariadb <span class="se">\</span>
             <span class="nt">-e</span> <span class="nv">DATASOURCES_DEFAULT_PASSWORD</span><span class="o">=</span>&lt;mariadb_password&gt; <span class="se">\</span>
             <span class="nt">-e</span> <span class="nv">DATASOURCES_DEFAULT_USERNAME</span><span class="o">=</span>&lt;mariadb_user&gt; <span class="se">\</span>
             <span class="nt">-e</span> <span class="nv">DATASOURCES_DEFAULT_DATABASE</span><span class="o">=</span>&lt;mariadb_database&gt; <span class="se">\</span>
             <span class="nt">-e</span> <span class="nv">APP_FULL_BASE_URL</span><span class="o">=</span>https://mydomain.com <span class="se">\</span>
             passbolt/passbolt:latest
</code></pre></div>    </div>

    <h3 id="using-docker-volumes">Using docker volumes</h3>

    <p>Users that use docker volumes should adjust their volumes paths.</p>

    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>docker run <span class="nt">--name</span> passbolt <span class="nt">--net</span> passbolt_network <span class="se">\</span>
             <span class="nt">--mount</span> <span class="nb">source</span><span class="o">=</span>&lt;passbolt_images_volume&gt;,<span class="se">\</span>
               <span class="nv">target</span><span class="o">=</span>/var/www/passbolt/webroot/img <span class="se">\</span>
             <span class="nt">--mount</span> <span class="nb">source</span><span class="o">=</span>&lt;gpg_keys_volume&gt;, <span class="se">\</span>
               <span class="nv">target</span><span class="o">=</span>/var/www/passbolt/config/gpg <span class="se">\</span>
             <span class="nt">-p</span> 443:443 <span class="se">\</span>
             <span class="nt">-p</span> 80:80 <span class="se">\</span>
             <span class="nt">-e</span> <span class="nv">DATASOURCES_DEFAULT_HOST</span><span class="o">=</span>mariadb <span class="se">\</span>
             <span class="nt">-e</span> <span class="nv">DATASOURCES_DEFAULT_PASSWORD</span><span class="o">=</span>&lt;mariadb_password&gt; <span class="se">\</span>
             <span class="nt">-e</span> <span class="nv">DATASOURCES_DEFAULT_USERNAME</span><span class="o">=</span>&lt;mariadb_user&gt; <span class="se">\</span>
             <span class="nt">-e</span> <span class="nv">DATASOURCES_DEFAULT_DATABASE</span><span class="o">=</span>&lt;mariadb_database&gt; <span class="se">\</span>
             <span class="nt">-e</span> <span class="nv">APP_FULL_BASE_URL</span><span class="o">=</span>https://mydomain.com <span class="se">\</span>
             passbolt/passbolt:latest
</code></pre></div>    </div>

    <div class="last-updated">
      <h3>Last updated</h3>
      <p>This article was last updated on 
April
10th,
2018.</p>
    </div>

  </div>
  <div class="col4 last push1">

    <div class="message tldr notice">
    <p>Are you experiencing issues when installing passbolt?</p>
    
    <a href="https://community.passbolt.com/c/installation-issues" class="button primary">Ask the community!</a>
    
</div>

    <div class="tldr">
    <h4 class="visuallyhidden">Available on docker hub</h4>
    <p>
        <a href="https://hub.docker.com/r/passbolt/passbolt/" target="_blank" rel="noopener nofollow">
            <img alt="Docker Logo" src="/assets/img/third_party/docker_small_h.png" style="" />
        </a>
    </p>
    <a href="https://hub.docker.com/r/passbolt/passbolt/" class="primary button">
        Get passbolt container!
    </a>
</div>

    <div class="message tldr">
    <p>Something is not accurate in this documentation? You can contribute by opening an issue or making pull requests!</p>
    
    <a href="https://www.github.com/passbolt/passbolt_help" class="button ">View on github</a>
    
</div>

    <div class="message tldr notice">
    <p>We highly recommend that you install https on your server. You can get a free SSL certificate with the let's encrypt initiative.</p>
    
    <a href="https://letsencrypt.org/" class="button ">let's encrypt!</a>
    
</div>

  </div>
</div>

                    </article>
                </div>
            </div>
        </div>
            <footer>
        <div class="footer">
            <ul class="footer-links">
                <li><a href="https://www.passbolt.com/licence">Terms</a></li>
                <li><a href="https://www.passbolt.com/privacy">Privacy</a></li>
                <li><a href="https://www.passbolt.com/credits">Credits</a></li>
                <li><a href="https://careers.passbolt.com">Careers</a></li>
            </ul>
        </div>
    </footer>
    <div id="cookies-eu-banner" class="visually-hidden">
        üç™ &nbsp; Do you accept cookies for statistical purposes?
        <a href="https://www.passbolt.com/privacy" id="cookies-eu-more">(Read more)</a>
        <a class="button primary" id="cookies-eu-accept">Accept</a>
        <a id="cookies-eu-reject">No thanks!</a>
    </div>


    </div>
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-23506466-3"></script>
<script src="https://code.jquery.com/jquery-3.5.0.slim.min.js" integrity="sha384-/IFzzQmt1S744I+IQO4Mc1uphkxbXt1tEwjQ/qSw2p8pXWck09sLvqHmKDYYwReJ" crossorigin="anonymous"></script>
<script src="https://help.passbolt.com/assets/js/cookies-eu-banner.js"></script>
<script src="https://help.passbolt.com/assets/js/analytics.js"></script>
<script src="https://help.passbolt.com/assets/js/greedynav.js"></script>
</body>

</html>