<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>Passbolt Help | Docker</title>
    <!--
             ____                  __          ____
            / __ \____  _____ ____/ /_  ____  / / /_
           / /_/ / __ `/ ___/ ___/ __ \/ __ \/ / __/
          / ____/ /_/ (__  |__  ) /_/ / /_/ / / /_
         /_/    \__,_/____/____/_.___/\____/_/\__/

         Open source password manager for teams
         ¬© 2019 Passbolt SA

     -->
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="">
    <meta property="og:image" content="http://localhost:4000/assets/img/background/og_preview.jpg" />
    <meta property="og:title" content="Docker" />
    <meta property="og:description" content="" />
    <link rel="stylesheet" href="http://localhost:4000/assets/css/help.min.css">
    <link rel="stylesheet" href="http://localhost:4000/assets/css/highlight.css">
    <link rel="stylesheet" href="http://localhost:4000/assets/css/cookie-eu-banner.css">
    <link rel="stylesheet" href="http://localhost:4000/assets/css/custom.css">
    <link rel="canonical" href="http://localhost:4000/hosting/backup/docker">
    <link rel="shortcut icon" type="image/x-icon" href="http://localhost:4000/assets/favicon.ico" />
    <link rel="alternate" type="application/rss+xml" title="Passbolt | Help" href="http://localhost:4000/feed.xml">
</head>


<body>
    <div id="container" class="help page background">
            <header>
        <div class="header first ">
            <nav class="greedy">
                <div class="top navigation primary">
                    <ul class="links clearfix">
                        <li class="home with-text"><a href="http://www.passbolt.com/"><span>home</span></a></li>
                        <li class="left"><a href="https://www.passbolt.com/services"><span>pricing</span></a></li>
                        <li class="left"><a href="https://www.passbolt.com/roadmap"><span>roadmap</span></a></li>
                        <li class="left"><a href="https://community.passbolt.com/"><span>forum</span></a></li>
                        <li class="left"><a href="https://www.passbolt.com/blog"><span>blog</span></a></li>
                        <li class="left selected"><a href="https://help.passbolt.com/"><span>help</span></a></li>
                        <li class="left"><a href="https://demo.passbolt.com" class="highlighted" target="_blank" rel="noopener"><span>try it!</span></a></li>
                    </ul>
                    <button class="hidden" count="0">more</button>
                    <ul class="hidden-links hidden"></ul>
                </div>
            </nav>
        </div>
    </header>
    <div class="header second">
        <div class="col1">
            <div class="logo no-img">
                <h1><span>Passbolt</span></h1>
            </div>
        </div>
        <div class="col2 search-wrapper">
            <h2 class="visuallyhidden">Help Search</h2>
            <div>
                <form class="search ready" action="/search.html" method="get">
                    <div class="input required">
                        <label for="search-box">Search</label>
                        <input id="search-box" name="query" maxlength="64" placeholder="Help search" class="fuzzy-search" type="search">
                    </div>
                    <button value="search">
                        <i class="fa fa-fw fa-search"></i>
                        <span class="text visuallyhidden">search</span>
                    </button>
                </form>
            </div>
        </div>
        <div class="col3">
            <div class="edit-on-github">
                <a href="https://github.com/passbolt/passbolt_help/edit/master/_posts/hosting/backup/2021-10-01-docker-backup.md" class="button">
                    <i class="fa fa-github-alt fa-fw"></i> Edit on github</a>
            </div>
        </div>
    </div>

        <div class="panel main" aria-label="Content">
            <div class="panel left">
                
                







<div class="navigation-help" role="navigation">
    <ul>
        <li>
            <h2>Hosting</h2>
        </li>
        
        <li >
            <a href="http://localhost:4000/faq/hosting">Hosting FAQ</a>
        </li>
        
        
        <li >
            <a href="http://localhost:4000/hosting/install">Installation</a>
        </li>
        
        
        <li >
            <a href="http://localhost:4000/hosting/update">Update</a>
        </li>
        
        
        <li >
            <a href="http://localhost:4000/hosting/upgrade">Upgrade</a>
        </li>
        
        
        <li >
            <a href="http://localhost:4000/hosting/backup">Backup</a>
        </li>
        
        
        
        
        <li >
            <a href="https://community.passbolt.com/c/installation-issues">Installation issues</a>
        </li>
        
        
    </ul>
</div>










                
            </div>
            <div class="panel middle" data-spy="scroll" data-target=".scrollspy">
                <div class="grid grid-responsive-12">
                    <article>
                        <div class="row" id="introduction">
    <div class="col12">
        <div class="breadcrumbs">
            <ul>
                <li>
                    <div class="main-cell">
                        <a href="https://www.passbolt.com"><span>home</span></a>
                    </div>
                </li>
                <li>
                    <div class="main-cell">
                        <a href="/"><span>help</span></a>
                    </div>
                </li>
                
                
                <li>
                    <div class="main-cell">
                        <a href="http://localhost:4000/hosting"><span>hosting</span></a>
                    </div>
                </li>
                
                <li>
                    <div class="main-cell">
                        <a href="http://localhost:4000/hosting/backup"><span>backup</span></a>
                    </div>
                </li>
                
                
                
                
                <li>
                    <div class="main-cell">
                        <a href="http://localhost:4000/hosting/backup/docker.html"><span>docker</span></a>
                    </div>
                </li>
                
            </ul>
        </div>
    </div>
</div>

                        <div class="row" markdown="1">
<div class="col7" markdown="1">
<h1>Docker</h1>
</div>
</div>

                        
<div class="row">
  <div class="col7">

    <p>Making regular backups is a critical aspect of managing a passbolt instance. Because passbolt stores important
information, it is equally important to have a backup strategy in place.</p>

    <p>As a passbolt administrator it is your responsibility to define how often and when to perform backups.
Please automate and customize this process to match the needs and policies of your organization.</p>

    <p>Here are some best practices to keep in mind:</p>

    <ul>
      <li>Ensure that the backups are taken at intervals that match your usage</li>
      <li>Take these backups off-site, or to another environment than the live one</li>
      <li>Make sure the backup is encrypted and stored in a safe location</li>
      <li>Practice drills and test the backups to make sure they work</li>
    </ul>

    <h2 id="what-to-backup">What to backup?</h2>

    <p>If you are a PRO user, ensure you have a backup of your subscription key.</p>

    <p>There are also several elements you need to backup:</p>

    <p>We assume here Passbolt container is named ‚Äú<strong>passbolt-container</strong>‚Äù and MariaDB 
container ‚Äú<strong>database-container</strong>‚Äù.
Please replace these names with your own. You can use <code class="language-plaintext highlighter-rouge">docker ps</code> for this.</p>

    <div class="message warning">
    <p>
        Many docker users use ‚Äú<code class="language-plaintext highlighter-rouge">-ti</code>‚Äù, ‚Äú<code class="language-plaintext highlighter-rouge">-it</code>‚Äù or ‚Äú<code class="language-plaintext highlighter-rouge">-t -i</code>‚Äù arguments to execute commands on docker containers. To get reliable backups on docker, please use only <code class="language-plaintext highlighter-rouge">-i</code>, as <code class="language-plaintext highlighter-rouge">-t</code> will create a pseudo-tty and make your backup files unusuable.
    </p>
    
</div>

    <h4 id="the-database">1. The database</h4>

    <p>This can be easily scripted using <a href="https://mariadb.com/kb/en/mariadb/mysqldump/">mysqldump</a>.
Use <code class="language-plaintext highlighter-rouge">docker exec</code> to connect to the Passbolt database container and write mysqldump output to a local file.</p>

    <p>Be sure to use simple-quotes for the <code class="language-plaintext highlighter-rouge">bash -c</code> argument to be able to use MYSQL_USER, MYSQL_PASSWORD and MYSQL_DATABASE environment variables.</p>

    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>docker <span class="nb">exec</span> <span class="nt">-i</span> database-container bash <span class="nt">-c</span> <span class="se">\</span>
  <span class="s1">'mysqldump -u${MYSQL_USER} -p${MYSQL_PASSWORD} ${MYSQL_DATABASE}'</span> <span class="se">\</span>
  <span class="o">&gt;</span> /path/to/backup.sql
</code></pre></div>    </div>

    <h4 id="the-server-public-and-private-keys">2. The server public and private keys</h4>

    <p>You can use <code class="language-plaintext highlighter-rouge">docker cp</code> to backup the Passbolt GPG keys:</p>

    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>docker <span class="nb">cp </span>passbolt-container:/etc/passbolt/gpg/serverkey_private.asc <span class="se">\</span>
    /path/to/backup/serverkey_private.asc
docker <span class="nb">cp </span>passbolt-container:/etc/passbolt/gpg/serverkey.asc <span class="se">\</span>
    /path/to/backup/serverkey.asc
</code></pre></div>    </div>

    <h4 id="the-application-configuration">3. The application configuration</h4>

    <p>Passbolt docker stores its configuration as environment variables.</p>

    <p>If you are using docker-compose, environment variables are on the env folder:</p>

    <ul>
      <li>env/passbolt.env</li>
      <li>env/mysql.env</li>
    </ul>

    <p>If you are running docker container, you should have passed these variables through the command line.
Please check the
<a href="/configure/environment/reference.html">passbolt env variable reference</a></p>

    <h4 id="the-avatars-for-passbolt-version-prior-to-32">4. The avatars (for Passbolt version prior to 3.2)</h4>

    <div class="message notice">
    <p>
    Since Passbolt 3.2, user‚Äôs avatars are no longer stored on disk but on the avatars table of passbolt database.
    </p>
    
</div>

    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>docker <span class="nb">exec</span> <span class="nt">-i</span> passbolt-container <span class="se">\</span>
    <span class="nb">tar </span>cvfzp - <span class="nt">-C</span> /usr/share/php/passbolt/ webroot/img/avatar <span class="se">\</span>
    <span class="o">&gt;</span> passbolt-avatars.tar.gz
</code></pre></div>    </div>

    <h2 id="backup-list">Backup list</h2>

    <p>At the end of the backup process you should have:</p>

    <ul>
      <li>a dump of your database</li>
      <li>the server public and private GPG keys</li>
      <li>a copy of your config/passbolt.php configuration file</li>
      <li>a copy of your avatar folder (<strong>only if Passbolt version &lt; 3.2</strong>)</li>
    </ul>

    <h2 id="migrate-the-back-up-to-the-new-server">Migrate the back-up to the new server</h2>

    <p>We will still consider that the backup files are in your user home directory ~/backup</p>

    <h3 id="on-the-original-server">On the original server</h3>

    <p>Use a tool such as tar to compress the backup directory</p>
    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>tar -cvzf /home/backup.tar.gz /home/backup
</code></pre></div>    </div>

    <p>You should copy the compressed backup file to the new server. Use a tool such as scp to do it</p>
    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>scp /home/backup.tar.gz new_server_username@server_ip:/home
</code></pre></div>    </div>

    <h3 id="on-the-new-server">On the new server</h3>

    <p>The compressed backup file should appears inside your home directory, we will extract using a tool such as tar</p>
    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>tar -xzvf /home/backup.tar.gz -C /home/backup
</code></pre></div>    </div>

    <p>The uncompressed backup file are now available inside your home directory.</p>

    <h2 id="what-about-the-secret-keys-of-my-collaborators">What about the secret keys of my collaborators?</h2>

    <p>Every user private key should also be backed up, this is however not something we/you can automate easily for now (passbolt might provide a functionality for this in the future). We believe it is best if this is the responsibility of the end user. There is a dedicated step during the extension setup to that purpose.</p>

    <p>As an administrator you should stress the importance of backing up secret keys to other users. For example this warning could be part of the initial information message sent to introduce passbolt to new users.</p>

    <p>It is possible that having users back up their own keys may not be realistic or desirable in your case. In this case you can opt in for an alternative strategy such as setting up the account with/for them and taking a backup of the secret keys then. In the worst case scenario you could automate the process by installing a script on your users machine that would make that backup for you.</p>

    <div class="last-updated">
      <h3>Last updated</h3>
      <p>This article was last updated on 
October
1st,
2021.</p>
    </div>

  </div>
  <div class="col4 last push1">

    <div class="message tldr notice">
    <p>Do you have a question about backups? Do you want to share your experience and best practices?</p>
    
    <a href="https://community.passbolt.com/c/installation-issues" class="button primary">Get in touch!</a>
    
</div>

    <div class="message ">
    <p></p>
    
</div>

  </div>
</div>

                    </article>
                </div>
            </div>
        </div>
            <footer>
        <div class="footer">
            <ul class="footer-links">
                <li><a href="https://www.passbolt.com/licence">Terms</a></li>
                <li><a href="https://www.passbolt.com/privacy">Privacy</a></li>
                <li><a href="https://www.passbolt.com/credits">Credits</a></li>
                <li><a href="https://careers.passbolt.com">Careers</a></li>
            </ul>
        </div>
    </footer>
    <div id="cookies-eu-banner" class="visually-hidden">
        üç™ &nbsp; Do you accept cookies for statistical purposes?
        <a href="https://www.passbolt.com/privacy" id="cookies-eu-more">(Read more)</a>
        <a class="button primary" id="cookies-eu-accept">Accept</a>
        <a id="cookies-eu-reject">No thanks!</a>
    </div>


    </div>
    <script src="https://consent.cookiebot.com/uc.js" data-cbid="900808a8-f178-4994-b2ad-66bf3ccca5f7" data-blockingmode="auto" strategy="beforeInteractive"></script>
<script src="http://localhost:4000/assets/js/matomo-tag-manager.js"></script>
<script src="http://localhost:4000/assets/js/matomo-analytics.js"></script>
<script src="https://code.jquery.com/jquery-3.5.0.slim.min.js" integrity="sha384-/IFzzQmt1S744I+IQO4Mc1uphkxbXt1tEwjQ/qSw2p8pXWck09sLvqHmKDYYwReJ" crossorigin="anonymous"></script>
<script src="http://localhost:4000/assets/js/analytics.js"></script>
<script src="http://localhost:4000/assets/js/greedynav.js"></script>
</body>

</html>