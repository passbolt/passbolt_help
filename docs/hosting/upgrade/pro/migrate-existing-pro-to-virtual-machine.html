<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>Passbolt Help | Migrate an existing Passbolt PRO to Virtual Machine</title>
    <!--
             ____                  __          ____
            / __ \____  _____ ____/ /_  ____  / / /_
           / /_/ / __ `/ ___/ ___/ __ \/ __ \/ / __/
          / ____/ /_/ (__  |__  ) /_/ / /_/ / / /_
         /_/    \__,_/____/____/_.___/\____/_/\__/

         Open source password manager for teams
         ¬© 2019 Passbolt SA

     -->
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="">
    <meta property="og:image" content="https://help.passbolt.com/assets/img/background/og_preview.jpg" />
    <meta property="og:title" content="Migrate an existing Passbolt PRO to Virtual Machine" />
    <meta property="og:description" content="" />
    <link rel="stylesheet" href="https://help.passbolt.com/assets/css/help.min.css">
    <link rel="stylesheet" href="https://help.passbolt.com/assets/css/highlight.css">
    <link rel="stylesheet" href="https://help.passbolt.com/assets/css/cookie-eu-banner.css">
    <link rel="stylesheet" href="https://help.passbolt.com/assets/css/custom.css">
    <link rel="canonical" href="https://help.passbolt.com/hosting/upgrade/pro/migrate-existing-pro-to-virtual-machine">
    <link rel="shortcut icon" type="image/x-icon" href="https://help.passbolt.com/assets/favicon.ico" />
    <link rel="alternate" type="application/rss+xml" title="Passbolt | Help" href="https://help.passbolt.com/feed.xml">
</head>


<body>
    <div id="container" class="help page background">
            <header>
        <div class="header first ">
            <nav class="greedy">
                <div class="top navigation primary">
                    <ul class="links clearfix">
                        <li class="home with-text"><a href="http://www.passbolt.com/"><span>home</span></a></li>
                        <li class="left"><a href="https://www.passbolt.com/services"><span>pricing</span></a></li>
                        <li class="left"><a href="https://www.passbolt.com/roadmap"><span>roadmap</span></a></li>
                        <li class="left"><a href="https://community.passbolt.com/"><span>forum</span></a></li>
                        <li class="left"><a href="https://www.passbolt.com/blog"><span>blog</span></a></li>
                        <li class="left selected"><a href="https://help.passbolt.com/"><span>help</span></a></li>
                        <li class="left"><a href="https://demo.passbolt.com" class="highlighted" target="_blank" rel="noopener"><span>try it!</span></a></li>
                    </ul>
                    <button class="hidden" count="0">more</button>
                    <ul class="hidden-links hidden"></ul>
                </div>
            </nav>
        </div>
    </header>
    <div class="header second">
        <div class="col1">
            <div class="logo no-img">
                <h1><span>Passbolt</span></h1>
            </div>
        </div>
        <div class="col2 search-wrapper">
            <h2 class="visuallyhidden">Help Search</h2>
            <div>
                <form class="search ready" action="/search.html" method="get">
                    <div class="input required">
                        <label for="search-box">Search</label>
                        <input id="search-box" name="query" maxlength="64" placeholder="Help search" class="fuzzy-search" type="search">
                    </div>
                    <button value="search">
                        <i class="fa fa-fw fa-search"></i>
                        <span class="text visuallyhidden">search</span>
                    </button>
                </form>
            </div>
        </div>
        <div class="col3">
            <div class="edit-on-github">
                <a href="https://github.com/passbolt/passbolt_help/edit/master/_posts/hosting/upgrade/2021-09-16-migrate-existing-pro-to-vm.md" class="button">
                    <i class="fa fa-github-alt fa-fw"></i> Edit on github</a>
            </div>
        </div>
    </div>

        <div class="panel main" aria-label="Content">
            <div class="panel left">
                
                







<div class="navigation-help" role="navigation">
    <ul>
        <li>
            <h2>Hosting</h2>
        </li>
        
        <li >
            <a href="https://help.passbolt.com/faq/hosting">Hosting FAQ</a>
        </li>
        
        
        <li >
            <a href="https://help.passbolt.com/hosting/install">Installation</a>
        </li>
        
        
        <li >
            <a href="https://help.passbolt.com/hosting/update">Update</a>
        </li>
        
        
        <li >
            <a href="https://help.passbolt.com/hosting/upgrade">Upgrade</a>
        </li>
        
        
        
        
        <li >
            <a href="https://help.passbolt.com/hosting/backup">Backup</a>
        </li>
        
        
        <li >
            <a href="https://community.passbolt.com/c/installation-issues">Installation issues</a>
        </li>
        
        
    </ul>
</div>










                
            </div>
            <div class="panel middle" data-spy="scroll" data-target=".scrollspy">
                <div class="grid grid-responsive-12">
                    <article>
                        <div class="row" id="introduction">
    <div class="col12">
        <div class="breadcrumbs">
            <ul>
                <li>
                    <div class="main-cell">
                        <a href="https://www.passbolt.com"><span>home</span></a>
                    </div>
                </li>
                <li>
                    <div class="main-cell">
                        <a href="/"><span>help</span></a>
                    </div>
                </li>
                
                
                <li>
                    <div class="main-cell">
                        <a href="https://help.passbolt.com/hosting"><span>hosting</span></a>
                    </div>
                </li>
                <li>
                    <div class="main-cell">
                        <a href="https://help.passbolt.com/hosting/upgrade"><span>upgrade</span></a>
                    </div>
                </li>
                
                
                
                <li>
                    <div class="main-cell">
                        <a href="https://help.passbolt.com/hosting/upgrade/pro/migrate-existing-pro-to-virtual-machine.html"><span>migrate-existing-pro-to-virtual-machine</span></a>
                    </div>
                </li>
                
            </ul>
        </div>
    </div>
</div>

                        <div class="row" markdown="1">
<div class="col7" markdown="1">
<h1>Migrate an existing Passbolt PRO to Virtual Machine</h1>
</div>
</div>

                        
<div class="row">
  <div class="col7">

    <p>This document describes how to migrate an existing passbolt to a new Virtual Machine Appliance.</p>

    <h2 id="pre-requisites">Pre-requisites</h2>

    <p>For this tutorial, you will need:</p>
    <ul>
      <li>Passbolt installed on an old server</li>
    </ul>

    <h2 id="backup-the-existing-data">Backup the existing data</h2>

    <p>Prior to the migration you will need to backup the existing passbolt instance data. Please refer to <a href="/hosting/backup">the official backup documentations</a>.</p>

    <p>Depending on your SSL configuration you might need to copy the certificate and key from the existing instance. If you are using let‚Äôs encrypt you can continue you‚Äôll configure it later directly in the new server.</p>

    <p>Don‚Äôt delete the existing instance yet!</p>

    <h2 id="prepare-the-virtual-machine-appliance-for-migration">Prepare the Virtual Machine Appliance for migration</h2>

    <div class="message warning">
    <p>
        While configuring the database ensure you are configuring the database as it was on your previous server, check the backup of the file passbolt.php for the configuration details.
    </p>
    
</div>

    <p>Passbolt Pro provides a virtual appliance in OVA format. Users can import this appliance on their private virtualization platform and start enjoying Passbolt Pro.
The VM includes the following software:</p>
    <ul>
      <li>Debian 11</li>
      <li>Nginx</li>
      <li>Php-fpm</li>
      <li>Mariadb</li>
      <li>Passbolt Pro preinstalled</li>
      <li>certbot</li>
      <li>haveged to fill the entropy pool faster</li>
    </ul>

    <h2 id="getting-started-with-passbolt-pro-vm">1. Getting started with Passbolt Pro VM</h2>

    <h3 id="download">1.1 Download</h3>

    <p>Download the ova and the SHA512SUM.txt:</p>

    <ul>
      <li><a href="https://www.passbolt.com/pro/download/vm/debian/latest">Passbolt Pro VM</a></li>
      <li><a href="https://www.passbolt.com/pro/download/vm/debian/latest-checksum">SHA512SUM.txt</a></li>
    </ul>

    <p>Import the ova file using virtualbox, vmware (ESXi &gt;= 6.0) or any other platform that supports import OVA files.</p>

    <p>Once imported into users should be able to boot the VM and just point to the VM ip address with their web browser to initiate the passbolt install process.</p>

    <h3 id="credentials">1.2 Credentials</h3>

    <p>The appliance performs some actions on the first boot:</p>
    <ul>
      <li>Creates ssh host keys</li>
      <li>Enables ssh</li>
      <li>Creates a set of random mariadb credentials for the mariadb server installed on the appliance</li>
      <li>Creates an empty database where passbolt can be installed.</li>
    </ul>

    <p>For the first login the appliance comes with the following ssh default credentials:</p>

    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>VM login credentials:
username: passbolt
password: admin
</code></pre></div>    </div>

    <p>The <code class="language-plaintext highlighter-rouge">passbolt</code> user is part of <code class="language-plaintext highlighter-rouge">sudo</code> group. There is no root password, so you cannot
login in as root. You can however create a shell as root with the default user:</p>
    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>sudo -s
</code></pre></div>    </div>

    <h2 id="configure-the-ova-services">Configure the OVA Services</h2>

    <p>Reconfigure the Passbolt package:</p>

    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>sudo dpkg-reconfigure passbolt-pro-server
</code></pre></div>    </div>

    <h4 id="configure-mariadb">Configure mariadb</h4>

    <p>If not instructed otherwise passbolt debian package will install mariadb-server locally. This step will help you create
an empty mariadb database for passbolt to use.</p>

    <figure>
    <img src="https://help.passbolt.com/assets/img/help/2020/05/debian-package/configure_mysql_pro.png" alt="Configure mariadb dialog" style="max-width:450px;" />
    <span class="legend">fig. Configure mariadb dialog</span>
</figure>

    <p>The configuration process will ask you for the credentials of the mariadb admin user to create a new database.
You will find the root password on the server in the file <code class="language-plaintext highlighter-rouge">/root/.mysql_credentials</code>.</p>

    <figure>
    <img src="https://help.passbolt.com/assets/img/help/2020/05/debian-package/mysql_admin_user_pro.png" alt="Mariadb admin user dialog" style="max-width:450px;" />
    <span class="legend">fig. Mariadb admin user dialog</span>
</figure>

    <figure>
    <img src="https://help.passbolt.com/assets/img/help/2020/05/debian-package/mysql_admin_user_pass_pro.png" alt="Mariadb admin user pass dialog" style="max-width:450px;" />
    <span class="legend">fig. Mariadb admin user pass dialog</span>
</figure>

    <p>Now we need to create a mariadb user with reduced permissions for passbolt to connect. For the passbolt database user and password, reuse the ones you have in your backup of passbolt.php.</p>

    <figure>
    <img src="https://help.passbolt.com/assets/img/help/2020/05/debian-package/passbolt_db_user_name_pro.png" alt="Mariadb passbolt user dialog" style="max-width:450px;" />
    <span class="legend">fig. Mariadb passbolt user dialog</span>
</figure>

    <figure>
    <img src="https://help.passbolt.com/assets/img/help/2020/05/debian-package/passbolt_db_user_pass_pro.png" alt="Mariadb passbolt user pass dialog" style="max-width:450px;" />
    <span class="legend">fig. Mariadb passbolt user pass dialog</span>
</figure>

    <p>Lastly we need to create a database for passbolt to use, for that we need to name it:</p>

    <figure>
    <img src="https://help.passbolt.com/assets/img/help/2020/05/debian-package/db_name_pro.png" alt="Mariadb database name dialog" style="max-width:450px;" />
    <span class="legend">fig. Mariadb database name dialog</span>
</figure>

    <p>Depending on your needs there are two different options to setup nginx and SSL using the debian package:</p>

    <ul>
      <li><a href="/configure/https/pro/debian/auto.html">Auto (Using Let‚Äôs Encrypt)</a></li>
      <li><a href="/configure/https/pro/debian/manual.html">Manual (Using user-provided SSL certificates)</a></li>
    </ul>

    <p>Once you‚Äôre done, restart the nginx server:</p>

    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>sudo systemctl restart nginx
</code></pre></div>    </div>

    <h2 id="migrate-data">Migrate data</h2>

    <p>Load the backup files into the new Debian server, for the following tasks we will consider that the backup files are in your user home directory <code class="language-plaintext highlighter-rouge">~/backup</code></p>

    <p>You should have:</p>

    <ul>
      <li>
        <p>Your subscription key</p>
      </li>
      <li>the private and public GPG key</li>
      <li>Your database dump</li>
      <li>The avatar archive file <code class="language-plaintext highlighter-rouge">passbolt-avatars.tar.gz</code> if you are coming from Passbolt prior to 3.2</li>
    </ul>

    <p><strong>Step 1.</strong> Create the subscription key file</p>

    <p>You received your subscription key by email, copy it as <code class="language-plaintext highlighter-rouge">/etc/passbolt/subscription_key.txt</code> on your server.</p>

    <p><strong>Step 2.</strong> Restore Passbolt configuration file and ensure rights and ownership are correct:</p>

    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>sudo mv ~/backup/passbolt.php /etc/passbolt
sudo chown www-data:www-data /etc/passbolt/passbolt.php
sudo chmod 440 /etc/passbolt/passbolt.php
</code></pre></div>    </div>

    <p><strong>Step 3.</strong> Restore GPG public and private keys and ensure rights and ownership are correct:</p>

    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>sudo mv ~/backup/serverkey.asc /etc/passbolt/gpg
sudo mv ~/backup/serverkey_private.asc /etc/passbolt/gpg
sudo chown www-data:www-data /etc/passbolt/gpg/serverkey_private.asc
sudo chown www-data:www-data /etc/passbolt/gpg/serverkey.asc
sudo chmod 440 /etc/passbolt/gpg/serverkey.asc
sudo chmod 440 /etc/passbolt/gpg/serverkey_private.asc
</code></pre></div>    </div>

    <p><strong>Step 4.</strong> Extract the passbolt-avatars.tar.gz archive and set correct rights (if coming from Passbolt version prior to 3.2)</p>

    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>sudo tar xzf passbolt-avatars.tar.gz -C /usr/share/php/passbolt/
sudo chown -R www-data:www-data /usr/share/php/passbolt/webroot/img/public
</code></pre></div>    </div>

    <p><strong>Step 5.</strong> Load the database</p>

    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>mysql -u PASSBOLT_DATABASE_USER -p PASSBOLT_DATABASE &lt; passbolt-backup.sql
</code></pre></div>    </div>

    <p><strong>Step 6.</strong> Migrate passbolt to the latest version</p>

    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>sudo -H -u www-data /bin/bash -c "/usr/share/php/passbolt/bin/cake passbolt migrate"
</code></pre></div>    </div>

    <p><strong>Step 7.</strong> Test passbolt</p>

    <p>Try to access your passbolt application with your browser.</p>

    <p>If you are encountering any issues, you can run the following command to assess the status of your instance:</p>

    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>sudo -H -u www-data /bin/bash -c "/usr/share/php/passbolt/bin/cake passbolt healthcheck"
</code></pre></div>    </div>
    <div class="last-updated">
      <h3>Last updated</h3>
      <p>This article was last updated on 
September
16th,
2021.</p>
    </div>

  </div>
  <div class="col4 last push1">

    <div class="message tldr notice">
    <p>Are you experiencing issues when updating passbolt?</p>
    
    <a href="https://community.passbolt.com/c/installation-issues" class="button primary">Ask the community!</a>
    
</div>

    <div class="message ">
    <p></p>
    
</div>

    <div class="message tldr">
    <p>Something is not accurate in this documentation? You can contribute by opening an issue or making pull requests!</p>
    
    <a href="https://www.github.com/passbolt/passbolt_help" class="button ">View on github</a>
    
</div>

  </div>
</div>

                    </article>
                </div>
            </div>
        </div>
            <footer>
        <div class="footer">
            <ul class="footer-links">
                <li><a href="https://www.passbolt.com/licence">Terms</a></li>
                <li><a href="https://www.passbolt.com/privacy">Privacy</a></li>
                <li><a href="https://www.passbolt.com/credits">Credits</a></li>
                <li><a href="https://careers.passbolt.com">Careers</a></li>
            </ul>
        </div>
    </footer>
    <div id="cookies-eu-banner" class="visually-hidden">
        üç™ &nbsp; Do you accept cookies for statistical purposes?
        <a href="https://www.passbolt.com/privacy" id="cookies-eu-more">(Read more)</a>
        <a class="button primary" id="cookies-eu-accept">Accept</a>
        <a id="cookies-eu-reject">No thanks!</a>
    </div>


    </div>
    <script src="https://consent.cookiebot.com/uc.js" data-cbid="900808a8-f178-4994-b2ad-66bf3ccca5f7" data-blockingmode="auto" strategy="beforeInteractive"></script>
<script src="https://help.passbolt.com/assets/js/matomo-tag-manager.js"></script>
<script src="https://help.passbolt.com/assets/js/matomo-analytics.js"></script>
<script src="https://code.jquery.com/jquery-3.5.0.slim.min.js" integrity="sha384-/IFzzQmt1S744I+IQO4Mc1uphkxbXt1tEwjQ/qSw2p8pXWck09sLvqHmKDYYwReJ" crossorigin="anonymous"></script>
<script src="https://help.passbolt.com/assets/js/analytics.js"></script>
<script src="https://help.passbolt.com/assets/js/greedynav.js"></script>
</body>

</html>