<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>Passbolt Help | Upgrade Passbolt CE from v1 to v2</title>
    <!--
             ____                  __          ____
            / __ \____  _____ ____/ /_  ____  / / /_
           / /_/ / __ `/ ___/ ___/ __ \/ __ \/ / __/
          / ____/ /_/ (__  |__  ) /_/ / /_/ / / /_
         /_/    \__,_/____/____/_.___/\____/_/\__/

         Open source password manager for teams
         ¬© 2019 Passbolt SA

     -->
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="">
    <meta property="og:image" content="https://help.passbolt.com/assets/img/background/og_preview.jpg" />
    <meta property="og:title" content="Upgrade Passbolt CE from v1 to v2" />
    <meta property="og:description" content="" />
    <link rel="stylesheet" href="https://help.passbolt.com/assets/css/help.min.css">
    <link rel="stylesheet" href="https://help.passbolt.com/assets/css/highlight.css">
    <link rel="stylesheet" href="https://help.passbolt.com/assets/css/cookie-eu-banner.css">
    <link rel="canonical" href="https://help.passbolt.com/hosting/upgrade/ce/upgrade-ce">
    <link rel="shortcut icon" type="image/x-icon" href="https://help.passbolt.com/assets/favicon.ico" />
    <link rel="alternate" type="application/rss+xml" title="Passbolt | Help" href="https://help.passbolt.com/feed.xml">

</head>


<body>
    <div id="container" class="help page background">
            <header>
        <div class="header first ">
            <nav class="greedy">
                <div class="top navigation primary">
                    <ul class="links clearfix">
                        <li class="home with-text"><a href="http://www.passbolt.com/"><span>home</span></a></li>
                        <li class="left"><a href="https://www.passbolt.com/services"><span>pricing</span></a></li>
                        <li class="left"><a href="https://www.passbolt.com/roadmap"><span>roadmap</span></a></li>
                        <li class="left"><a href="https://community.passbolt.com/"><span>forum</span></a></li>
                        <li class="left"><a href="https://www.passbolt.com/blog"><span>blog</span></a></li>
                        <li class="left selected"><a href="https://help.passbolt.com/"><span>help</span></a></li>
                        <li class="left"><a href="https://demo.passbolt.com" class="highlighted" target="_blank" rel="noopener"><span>try it!</span></a></li>
                    </ul>
                    <button class="hidden" count="0">more</button>
                    <ul class="hidden-links hidden"></ul>
                </div>
            </nav>
        </div>
    </header>
    <div class="header second">
        <div class="col1">
            <div class="logo no-img">
                <h1><span>Passbolt</span></h1>
            </div>
        </div>
        <div class="col2 search-wrapper">
            <h2 class="visuallyhidden">Help Search</h2>
            <div>
                <form class="search ready" action="/search.html" method="get">
                    <div class="input required">
                        <label for="search-box">Search</label>
                        <input id="search-box" name="query" maxlength="64" placeholder="Help search" class="fuzzy-search" type="search">
                    </div>
                    <button value="search">
                        <i class="fa fa-fw fa-search"></i>
                        <span class="text visuallyhidden">search</span>
                    </button>
                </form>
            </div>
        </div>
        <div class="col3">
            <div class="edit-on-github">
                <a href="https://github.com/passbolt/passbolt_help/edit/master/_posts/hosting/upgrade/2018-03-14-hosting-upgrade-ce.md" class="button">
                    <i class="fa fa-github-alt fa-fw"></i> Edit on github</a>
            </div>
        </div>
    </div>

        <div class="panel main" aria-label="Content">
            <div class="panel left">
                
                







<div class="navigation-help" role="navigation">
    <ul>
        <li>
            <h2>Hosting</h2>
        </li>
        
        <li >
            <a href="https://help.passbolt.com/faq/hosting">Hosting FAQ</a>
        </li>
        
        
        <li >
            <a href="https://help.passbolt.com/hosting/install">Installation</a>
        </li>
        
        
        <li >
            <a href="https://help.passbolt.com/hosting/update">Update</a>
        </li>
        
        
        <li >
            <a href="https://help.passbolt.com/hosting/upgrade">Upgrade</a>
        </li>
        
        
        
        
        <li >
            <a href="https://help.passbolt.com/hosting/backup">Backup</a>
        </li>
        
        
        <li >
            <a href="https://community.passbolt.com/c/installation-issues">Installation issues</a>
        </li>
        
        
    </ul>
</div>










                
            </div>
            <div class="panel middle" data-spy="scroll" data-target=".scrollspy">
                <div class="grid grid-responsive-12">
                    <article>
                        <div class="row" id="introduction">
    <div class="col12">
        <div class="breadcrumbs">
            <ul>
                <li>
                    <div class="main-cell">
                        <a href="https://www.passbolt.com"><span>home</span></a>
                    </div>
                </li>
                <li>
                    <div class="main-cell">
                        <a href="/"><span>help</span></a>
                    </div>
                </li>
                
                
                <li>
                    <div class="main-cell">
                        <a href="https://help.passbolt.com/hosting"><span>hosting</span></a>
                    </div>
                </li>
                <li>
                    <div class="main-cell">
                        <a href="https://help.passbolt.com/hosting/upgrade"><span>upgrade</span></a>
                    </div>
                </li>
                
                
                
                <li>
                    <div class="main-cell">
                        <a href="https://help.passbolt.com/hosting/upgrade/ce/upgrade-ce.html"><span>upgrade-ce</span></a>
                    </div>
                </li>
                
            </ul>
        </div>
    </div>
</div>

                        <div class="row" markdown="1">
<div class="col7" markdown="1">
<h1>Upgrade Passbolt CE from v1 to v2</h1>
</div>
</div>

                        <div class="row">
  <div class="col7">

    <p>This tutorial covers the case where you want to upgrade your current instance of passbolt CE v1.x into passbolt CE v2.x.</p>

    <div class="message warning">
    <p>
        <strong>Important:</strong> Please take a full <a href="/hosting/backup-v1">backup</a> of your passbolt before proceeding with the upgrade. Backup should include passbolt files as well as the database.
    </p>
    
</div>

    <h2 id="system-requirements">System requirements</h2>

    <p>Passbolt is reported to work on a large variety of operating system configurations.
Therefore this help page is a generic guide that should work for most environments.</p>

    <p>If you run into any issues with your particular configuration,
<a href="https://community.passbolt.com/c/installation-issues">please check the forum</a>.
Maybe someone else has had your issue. If not, make a post and the community will try to help you.</p>

    <ul>
      <li>Any Unix-like major distribution (Debian, Centos, Ubuntu, *BSD)</li>
      <li>A webserver (Apache or Nginx)</li>
      <li>A TLS server certificate for HTTPS</li>
      <li>PHP &gt;= 7.0.0</li>
      <li>MariaDB/Mysql &gt;= 5.5.59</li>
      <li><a href="https://getcomposer.org/download/">Composer</a></li>
      <li><a href="https://gnupg.org/">GnuPG</a></li>
      <li><a href="https://git-scm.com/">Git</a></li>
    </ul>

    <p>The following PHP extensions (that may or may not come by default):</p>
    <ul>
      <li><a href="http://php.net/manual/en/gnupg.installation.php">PHP-GNUPG</a>: for key verification and authentication.</li>
      <li>Cakephp default requirements: Intl, mbstring, simplexml</li>
      <li>Image manipulation: gd or imagick</li>
      <li>Database: Mysqlnd, pdo, pdo_mysql</li>
      <li>Some general default: xsl, phar, posix, xml, zlib, ctype, curl, json.</li>
      <li><a href="https://secure.php.net/manual/en/ldap.installation.php">Ldap</a></li>
      <li>&amp; more depending on your configuration (for example if you want to use memcache for sessions).</li>
    </ul>

    <h2 id="upgrade-with-a-new-server">Upgrade with a new server</h2>

    <p>Considering that the system requirements haved it may make sense for you to upgrade on a fresh server.
If that is what you want to do, copy the v1 <a href="/hosting/backup-v1">backup</a> files to your new server, import your passbolt
database into your new server and proceed like you were upgrading on the same server, with the process described below.</p>

    <h2 id="upgrade-from-the-same-server">Upgrade from the same server</h2>

    <p>In the following examples we assume you are running passbolt v1 using apache in the <code class="language-plaintext highlighter-rouge">/var/www/passbolt</code>
directory. You will need to replace these values with your local environment settings.</p>

    <h3 id="make-sure-you-have-the-latest-v1x-version">1. Make sure you have the latest v1.x version</h3>
    <p>If you do not have the latest version, please follow the regular <a href="/hosting/update-v1">v1 udpate process</a>.
We‚Äôll also assume you have a web server that match the system requirements.</p>

    <div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>/var/www/passbolt<span class="nv">$ </span><span class="nb">cat </span>app/Config/version.php  | <span class="nb">grep </span>number
<span class="s1">'number'</span> <span class="o">=&gt;</span> <span class="s1">'1.6.10'</span>
</code></pre></div>    </div>

    <h3 id="take-your-site-offline">2. Take your site offline</h3>
    <p>There are multiple ways of doing that, the simplest is sending a notice by email to your users
and stopping your webserver. The better approach would be to create a temporary html file and
redirect your passbolt user there.</p>

    <h3 id="download-the-v2">3. Download the v2</h3>
    <p>Open a shell with the same user as your web server user. (usually, www-data for apache, nginx for nginx)</p>

    <div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>/var/www<span class="nv">$ </span>su <span class="nt">-s</span> /bin/bash www-data
</code></pre></div>    </div>

    <p>Replace the previous passbolt by the new version.</p>

    <div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>/var/www<span class="nv">$ </span><span class="nb">mv</span> ./passbolt ./passbolt_old
/var/www<span class="nv">$ </span>git clone https://github.com/passbolt/passbolt_api.git ./passbolt
</code></pre></div>    </div>

    <h3 id="install-the-dependencies">4. Install the dependencies</h3>
    <div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>/var/www<span class="nv">$ </span><span class="nb">cd</span> ./passbolt
/var/www/passbolt<span class="nv">$ </span>composer <span class="nb">install</span> <span class="nt">--no-dev</span>
</code></pre></div>    </div>

    <h3 id="copy-the-avatar-folder">5. Copy the avatar folder</h3>
    <div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>/var/www/passbolt<span class="nv">$ </span><span class="nb">cp</span> <span class="nt">-R</span> ../passbolt_old/app/webroot/img/public/<span class="k">*</span> ./webroot/img/public/.
/var/www/passbolt<span class="nv">$ </span><span class="nb">mv</span> ./webroot/img/public/images/ProfileAvatar ./webroot/img/public/images/Avatar
</code></pre></div>    </div>

    <h3 id="copy-the-server-gpg-key">6. Copy the server gpg key</h3>
    <div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>/var/www/passbolt<span class="nv">$ </span><span class="nb">cp</span> ../passbolt_old/app/Config/gpg/<span class="k">*</span> config/gpg/.
</code></pre></div>    </div>

    <h3 id="create-a-passbolt-configuration-file">7. Create a passbolt configuration file</h3>

    <p>The name and values in the main configuration file have changed. Everything is now located in one file called
<code class="language-plaintext highlighter-rouge">config/passbolt.php</code>. Do not copy your v1 configuration files, instead you need to create a new one:</p>

    <div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>/var/www/passbolt<span class="nv">$ </span><span class="nb">cp </span>config/passbolt.default.php config/passbolt.php
/var/www/passbolt<span class="nv">$ </span>nano config/passbolt.php
</code></pre></div>    </div>

    <p>Even if the format has changed the information needed are pretty much the same than v1.
You will need to set at least the following:</p>
    <ul>
      <li>Application full base url</li>
      <li>Database configuration</li>
      <li>Email settings</li>
      <li>Server OpenPGP key fingerprint.</li>
    </ul>

    <p>You can also set your configuration using environment variables.
Check <code class="language-plaintext highlighter-rouge">config/default.php</code> to get the names of the environment variables.</p>

    <h3 id="run-the-migration-script">8. Run the migration script</h3>

    <p>The structure of the database changed in version 2. Make sure you run the following script to migrate your
data to the new format.</p>

    <div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>/var/www/passbolt<span class="nv">$ </span>./bin/cake passbolt migrate
</code></pre></div>    </div>

    <p>Optionally you can also run the health check to see if everything is fine.</p>

    <div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span><span class="nb">sudo </span>su <span class="nt">-s</span> /bin/bash <span class="nt">-c</span> <span class="s2">"./bin/cake passbolt healthcheck"</span> www-data
</code></pre></div>    </div>

    <h3 id="modify-the-cron-job-to-send-emails">9. Modify the cron job to send emails</h3>

    <p>Modify the cronjob entry you had added for passbolt CE v1 :</p>
    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>* * * * * /var/www/passbolt/app/Console/cake EmailQueue.sender &gt; /var/log/passbolt.log
</code></pre></div>    </div>

    <p>into this one:</p>
    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>* * * * * /var/www/passbolt/bin/cake EmailQueue.sender &gt; /var/log/passbolt.log
</code></pre></div>    </div>

    <h3 id="get-your-service-back-online">10. Get your service back online</h3>

    <p>Edit your apache or nginx to point to the new directory and bring your service back online.</p>
    <div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>nano /etc/apache2/sites-enabled/001-default.conf
<span class="nv">$ </span>service apache2 restart
</code></pre></div>    </div>

    <div class="last-updated">
      <h3>Last updated</h3>
      <p>This article was last updated on 
March
14th,
2018.</p>
    </div>

  </div>
  <div class="col4 last push1">

    <div class="message tldr notice">
    <p>Are you experiencing issues when installing passbolt?</p>
    
    <a href="https://community.passbolt.com/c/installation-issues" class="button primary">Ask the community!</a>
    
</div>

    <div class="tldr">
    <h4 class="visuallyhidden">Available on docker hub</h4>
    <p>
        <a href="https://hub.docker.com/r/passbolt/passbolt/" target="_blank" rel="noopener nofollow">
            <img alt="Docker Logo" src="/assets/img/third_party/docker_small_h.png" style="" />
        </a>
    </p>
    <a href="https://hub.docker.com/r/passbolt/passbolt/" class="primary button">
        Get passbolt container!
    </a>
</div>

    <div class="message tldr">
    <p>Something is not accurate in this documentation? You can contribute by opening an issue or making pull requests!</p>
    
    <a href="https://www.github.com/passbolt/passbolt_help" class="button ">View on github</a>
    
</div>

    <div class="message tldr notice">
    <p>We highly recommend that you install https on your server. You can get a free SSL certificate with the let's encrypt initiative.</p>
    
    <a href="https://letsencrypt.org/" class="button ">let's encrypt!</a>
    
</div>

  </div>
</div>

                    </article>
                </div>
            </div>
        </div>
            <footer>
        <div class="footer">
            <ul class="footer-links">
                <li><a href="https://www.passbolt.com/licence">Terms</a></li>
                <li><a href="https://www.passbolt.com/privacy">Privacy</a></li>
                <li><a href="https://www.passbolt.com/credits">Credits</a></li>
                <li><a href="https://careers.passbolt.com">Careers</a></li>
            </ul>
        </div>
    </footer>
    <div id="cookies-eu-banner" class="visually-hidden">
        üç™ &nbsp; Do you accept cookies for statistical purposes?
        <a href="https://www.passbolt.com/privacy" id="cookies-eu-more">(Read more)</a>
        <a class="button primary" id="cookies-eu-accept">Accept</a>
        <a id="cookies-eu-reject">No thanks!</a>
    </div>


    </div>
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-23506466-3"></script>
<script src="https://code.jquery.com/jquery-3.5.0.slim.min.js" integrity="sha384-/IFzzQmt1S744I+IQO4Mc1uphkxbXt1tEwjQ/qSw2p8pXWck09sLvqHmKDYYwReJ" crossorigin="anonymous"></script>
<script src="https://help.passbolt.com/assets/js/cookies-eu-banner.js"></script>
<script src="https://help.passbolt.com/assets/js/analytics.js"></script>
<script src="https://help.passbolt.com/assets/js/greedynav.js"></script>
</body>

</html>